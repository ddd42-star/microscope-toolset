MethodsinMicroscopy2024;1(1):19–30
Tutorial
MaciejDobrzyński*,BenjaminGrädel,PaoloArmandoGagliardiandOlivierPertz
Quantificationofcollectivesignallingin
time-lapsemicroscopyimages
https://doi.org/10.1515/mim-2024-0003
ReceivedMarch14,2024;acceptedJune2,2024;
publishedonlineJune19,2024
Abstract: Live-cell imaging of ﬂuorescent biosensors has
demonstrated that space-time correlations in signalling of
cell collectives play an important organisational role in
morphogenesis, wound healing, regeneration, and main-
taining epithelial homeostasis. Here, we demonstrate how
to quantify one such phenomenon, namely apoptosis-
induced ERK activity waves in the MCF10A epithelium. We
present a protocol that starts from raw time-lapse ﬂuo-
rescence microscopy images and, through a sequence of
imagemanipulations,endswithARCOS,ourcomputational
methodtodetectandquantifycollectivesignalling.Wealso
describethesameworkﬂowintheinteractivenapariimage
viewer to quantify collective phenomena for users with-
out prior programming experience. Our approach can be
applied to space-time correlations in cells, cell collectives,
or communities of multicellular organisms, in 2D and 3D
geometries.
Keywords:cell signalling; image analysis; time-lapse
microscopy;spatialclustering;collectivephenomena
1 Introduction
In this tutorial, we describe a computational pipeline to
identify apoptosis-induced collective ERK activity waves
*Corresponding author: Maciej Dobrzyński, Institute of Cell Biology,
UniversityofBern,Bern,Switzerland,
E-mail:maciej.dobrzynski@unibe.ch.https://orcid.org/0000-0002-0208-
7758
Benjamin Grädel, Institute of Cell Biology, University of Bern, Bern,
Switzerland; and GraduateSchoolforCellularandBiomedicalSciences,
UniversityofBern,Bern,Switzerland,E-mail: benjamin.graedel@unibe.ch.
https://orcid.org/0000-0002-1995-0263
PaoloArmandoGagliardi and OlivierPertz, InstituteofCellBiology,
UniversityofBern,Bern,Switzerland,E-mail: paolo.gagliardi@unibe.ch
(P.A.Gagliardi), olivier.pertz@unibe.ch(O.Pertz). https://orcid.org/0000-
0002-4818-035X (P. A. Gagliardi).https://orcid.org/0000-0001-8579-4919
(O.Pertz)
from ﬂuorescence microscopy time-lapse images of a
starvedwild-typeMCF10Aepithelium( Figure1A).Weprevi-
ouslydescribedthisbiologicalphenomenoninwhichapop-
totic epithelial cells trigger extracellular signal-regulated
kinase(ERK)andAKTserine/threoninekinase(Akt)activity
wavesthataretransmittedradiallytohealthyneighbouring
cells [1]. The waves are mediated within the epithelium
through matrix metalloproteinase (MMP) and epidermal
growth factor receptor (EGFR) signalling. ERK/Akt waves
provide spatial survival signals that locally protect cells
aroundtheepithelialinjuryfromapoptosisfor3–4h.Atthe
cellpopulationlevel,ERK/Aktwavescontributetoepithelial
homeostasis (EH) by increasing the overall cell survival in
response to perturbations. Disruption of this spatial sig-
nallingsystempreventsamodelepithelialtissuefrommain-
taining a barrier function in response to environmental
insults.
ERKactivitywaveshaverecentlybeendemonstratedto
becrucialinthemaintenanceofepithelialhomeostasis[ 2],
[3], acinar morphogenesis [4], osteoblast regeneration [5],
cellcycleprogression,andthecoordinationofcollectivecell
migration in wound healing [6], [7]( Figure1B). However,
despiteourtutorialfocusingoncellsignalling,themethod-
ology presented here can be applied to wave phenomena
emerging in other systems, such as action potential prop-
agating within individual neurons, chemical, mechanical,
and genetic waves in cell collectives, as well as waves in
communitiesofmulticellularorganisms[8].
As we demonstrate below, our computational pipeline
quantiﬁes collective events (CEs) in segmented time-lapse
images both, programmatically and through a graphical
user interface. The calculated properties of CEs include:
duration and size, i.e., the total number of unique cells
involvedinanevent,growthdynamicsofindividualevents,
convexhullaroundevents,anddisplacementofthecentre
ofmassovertime(Figure1C).
2 Methods
ThehumanmammarycellsMCF10Awerestablytransfected
with a nuclear Histone 2B (H2B) marker for identifying
OpenAccess. ©2024theauthor(s),publishedbyDeGruyteronbehalfofThossMedia. ThisworkislicensedundertheCreativeCommonsAttribution4.0
InternationalLicense.
20 — M.Dobrzyńskietal.:Quantificationofcollectivesignalling
Figure1: Schematiccollectiveevents.(A)Radiallyexpandingwaves,asincollectiveERK/Aktactivityinducedbyacellundergoingapoptosisin
epithelialtissue.Thenoodleplotontherightvisualisescollectiveeventsonaspace-timeplane.Eachlinecorrespondstoasinglecellwhenit
participatesintheevent.(B)Directionalwaves,asintravellingERKactivitywavesoriginatingattheedgeofawound.(C)Propertiesofcollectiveevents
calculatedinourpipeline.
and tracking nuclei, and an ERK-KTR biosensor for mea-
suringERKactivity.Thelatterreversiblytranslocatesfrom
the nucleus to the cytosol upon ERK activation [9]. Images
wereacquiredforbothchannelsfor25hata5-mininterval,
resulting in two TIFF stacks, 300 frames each, at 1, 024×
1, 024pixelsthatcoveraﬁeldofviewof332.80 ×332.80μm
(SupplementaryFile1 )[10].Cellswereculturedinstarving
medium, without external stimulation, which minimises
proliferation rate and maintains ERK activity at the basal
level,whereERKactivitypulsesaremainlyduetoapoptotic-
induced waves. For a detailed description of experimental
procedures,referto[8].
The image analysis pipeline is implemented as a
Jupyter notebook [11] with the Python programming lan-
guage [12]( Figure2 and SupplementaryFile2 )[ 10], [13].
Optional, interactive visualisations of every step are avail-
ableinthenapariimageviewer[14].Thecorealgorithmfor
Automatic Recognition of COllective Signalling (ARCOS) is
implemented in the arcos4py package [15] and extensively
describedin[ 8].Additionally,theanalysisreliesonseveral
Pythonlibrariesthatneedtobeinstalled,e.g.,usingthe pip
installcommand,andimportedbeforeproceeding:
– numpy [16]andpandas[ 17]fordataprocessing,
– tifffile for reading and writing TIFF image stacks
[18],
– joblib for enabling parallel processing on multiple
CPUcores[ 19],
– napari for interactive viewing of time-lapse images
[14],
– stardistforimagesegmentation[ 20]–[22],
– skimage [23] and an optional package used in napari
GUI –pyclesperanto_prototype [24]formanipulat-
inglabelsobtainedfromsegmentation,
– btrack fortrackingobjectsovertime[ 25],
– matplotlib forplottingtheresultsintheJupyternote-
book[26].
We recommend creating a Python environment using a
package manager such asconda or mamba [27]. YAML con-
ﬁgurationforthePythonenvironmentformacOS,Windows
andLinuxisprovidedinSupplementaryFile3 .
2.1 Loadingthedata
Images, providedastwoTIFFstackswithnuclearandERK
activity channels, respectively, can be loaded as NumPy
arrays with theimread function from thetifffile pack-
age[28]:
Each stack is stored in theTYX order, whereT corre-
sponds to the time axis, andYX are spatial coordinates of
the image. To view and interactively browse the stack, we
turn to the napari image viewer, which can be accessed
programmatically from the notebook. The following code
opensaseparateviewerwindow:
Themethod viewer.add_image() canbethenusedto
addindividualstacksaslayersinnapari,togetherwiththe
colourmapspeciﬁcationandcontrastlimits:
M.Dobrzyńskietal.:Quantificationofcollectivesignalling — 21
Figure2: Pipelineoverview.BioimageanalysisstepsrequiredtoidentifycollectiveERKactivitywavesintheMCF10Aepithelium.WeuseStarDist
[20]–[22]tosegmentthenuclei;scikit-image[ 23]tomanipulatelabelsandcreatecytosolicmaskstomeasurefluorescenceintensity;btrack[ 25]to
trackthenucleiovertime;ARCOS[ 8]toidentifyandquantifyspatio-temporalcorrelationsinERKactivitysignalling.
2.2 Imagesegmentation
For identifying nuclei from the H2B channel, we use a
Python implementation of star-convex object detection for
2D and 3D images, as described in [20]–[22]. The method
is based on a convolutional neural network that, for every
pixel,predictsapolygonforthecellinstanceatthatposition.
Thepackageprovidesapretrainedmodel,2D_versatile_ﬂuo,
for2Dimagesofnuclearﬂuorescentmarkers.Asaprepara-
tionstep,wecreateaninstanceofapretrainedmodel:
We then pre-allocate a NumPy array of the same size
as the image stack, which we will use to store segmenta-
tion labels. The input images need to be normalised to the
same range as the data used to train the StarDist model,
i.e., [0,1]. Therefore, we normalise ﬂuorescence intensities
in every frame usingnormalize from the csbdeep.utils
package. Finally, we loop over frames of the H2B channel
stack and predict the location of nuclei using StarDist’s
model.predict_instances. If no parameters are pro-
vided, the prediction step uses a default threshold for the
probability, 0.479071, which can be overridden with the
prob_thresh parameter.
2.3 Labelmanipulation
TheNumPyarray np_lab resultingfromthesegmentation
is a so-calledlabelled mask . It contains, for every frame,
integers denoting object identiﬁers of nuclei at every pixel
location where the StarDist model predicted the nuclei. It
will later allow us to extract measurements of individual
cells, e.g., ﬂuorescence intensity or area, from the images.
However, before proceeding, we process the labels using
several functions from thescikit-image library for image
processing[23].
22 — M.Dobrzyńskietal.:Quantificationofcollectivesignalling
First,weremovesmalllabelsthatcorrespondtodebris
or wrong segmentation using theremove_small_objects
function from theskimage.morphology utility module of
scikit-image. To obtain the ﬁnal nuclear mask, we set the
threshold for the minimum area of nuclei (Figure3A). The
ﬁlterthresholdmin_size =200removesallobjectscompris-
inglessthan200pixels,whichcorrespondstoaroundobject
ofdiameter≈16pixels(5.2 μm).
To quantify ERK activity from the ERK-KTR translo-
cation biosensor, we calculate the ratio between the
meancytosolicandnuclearﬂuorescenceintensities,which
requires creating an image mask for the cytosol. For
every time frame, we perform a series of operations on
the existing nuclear mask that create a 4-pixel-wide ring
around the nucleus. In the absence of a cytosolic or mem-
brane marker, the ring acts as a proxy for the cytosol.
First, we expand the nuclear labels by 6 pixels using
expand_labels from skimage.segmentation. Then, we sub-
tract a smaller mask, also obtained from the nuclear mask
but only by expanding it by 2 pixels. Rings are 4 pixels
wide, with a gap of 2 pixels between the nuclei and rings
(Figure3B).
The exact pixel value by which to expand the nucleus
and the thickness of the cytosolic ring depends on cell size
and density. Importantly, the ring should minimally over-
lap with neighbouring cells. We recommend verifying the
results visually by plotting the masks on raw images, as in
Figure3AandB.
2.4 Extractingmeasurements
Having identiﬁed labelled masks for nuclei and cytoplas-
mic rings (Figure3C), we can now extract properties from
the ERK-KTR channel for every labelled region in the ﬁeld
of view. Again, we loop over frames ofnp_lab_filt and
np_lab_ring arrays,andapply regionprops_table from
skimage.measure to extract the mean ﬂuorescence inten-
sity,centroidcoordinates,andlabelidentiﬁerthatallowsus
totrackthenuclei:
Similar steps, but only with
properties = [‘intensity_mean’, ‘label’] , yield
anotherpandasdataframe, df_prop_cyto,withproperties
for the cytosolic ring. To obtain a single data frame
containing,inasinglerow,nuclearandcytosolicproperties
of a cell at a time point, we merge the two tables based on
twocommonkeycolumns:objectlabel‘obj_id’andframe
number ‘t’ (both integers). To facilitate the merge, we
rename the columns indf_prop_nuc and df_prop_cyto
generatedby regionprops_table,i.e.:
– label →obj_id,
– intensity_mean →intensity_mean_nuc and inten-
sity_mean_cyto for df_prop_nuc and df_prop_cyto,
respectively,
– centroid −0 →y and centroid −1 →x,w h i c ha r e
onlypresentindf_prop_nuc.
Usingthe pd.merge function,weobtainasingledataframe,
df_prop, with object label identiﬁers, positions of nuclear
M.Dobrzyńskietal.:Quantificationofcollectivesignalling — 23
Figure3: Imagesegmentation.TheresultofnucleisegmentationwithStarDist(A)andidentificationofcytosolicrings(B)overlaidonnuclearandERK
channels,respectively.(C)Nuclearandcytosolicringmasks.
centroids,andnuclearandcytoplasmicﬂuorescenceinten-
sities, from which we can later calculate the cytoplas-
mic/nuclearratio,C/NERK-KTR(Figure4).
2.5 Tracking
To track single cells over time, we turn to another Python
library,btrack [25]. It is a commonly used algorithm that
uses objects’ positions and properties, e.g., labels’ area,
to reconstruct trajectories in crowded environments such
as the conﬂuent epithelium discussed here. For the full
code required to track the nuclei, we refer the reader to
theJupyternotebook(SupplementaryFile2 ).Conﬁguration
parametersandthemotionmodelforparticletrackingare
stored in a JSON ﬁle (SupplementaryFile4 ), and can be
loadedusingtheconﬁguremethodofthe BayesianTracker
class.Theparameterofinteresttousisthe update_method,
which we set toBayesianUpdates.APPROXIMATE,w h i c h
calls a faster, approximate algorithm suitable for larger
datasets. The associated parameter,max_search_radius,
determines the local spatial search radius. We set it to 70
pixels (22.75μm), which corresponds to the upper limit of
a cell diameter and is sufficient to track frame-to-frame
celldisplacementsencounteredinourtime-lapse(Figure3A
Figure4: Mergingtables.Twopandasdataframescontainingpropertiescalculatedfromnuclearandcytoplasmicringmasks,respectively,are
mergedbytwocommonkeycolumns:objectlabel‘obj_id’andframenumber‘t’(bothintegers).Theresulting‘df_prop’containsobjectlabel
identifiers,positionsofnuclearcentroids,andnuclearandcytoplasmicfluorescenceintensities.
24 — M.Dobrzyńskietal.:Quantificationofcollectivesignalling
and SupplementaryVideo1 ). A smaller search radius may
fail to track moving nuclei, which results in disjointed
segments that should otherwise comprise a single track.
Whenmax_search_radius istoolarge,asingletracklabel
may be assigned to different objects in subsequent time
frames, thus making measurements extracted from such
tracksworthless.
TheinputdataforbtrackisaNumPyarraywithlabelled
nuclei, np_lab_filt,f r o mw h i c hx & y coordinates and
the nuclear area are extracted to facilitate tracking. After
tracking,btrackoutputsaPythonlist,whereeachelementis
adataframe(object of class Tracklet ).Onesuchdata
framecontainsatableinlongformatofasingletrack,where
rowsrefertoobjectsinthetrackatconsecutivetimepoints.
Allthosedataframesfromthelistarethenmergedwiththe
dataframedf_prop thatcontainsnuclearandcytoplasmic
measurements,usingcommoncolumns‘t’and‘ obj_id’.We
thus obtain a data framedf_tracks suitable for the last
step of collective event identiﬁcation with ARCOS. It con-
tains nuclear positions and cytoplasmic/nuclear ERK-KTR
ratio measurements in all time frames, with an additional
columntrack_idthatholdsintegeridentiﬁersoftracks/time
series.Additionally,btrackprovidesconveniencefunctions
toobtainthedatainaformatsuitableforloadingintonapari
(SupplementaryFile2 ).
Tracking and merging with the measurement
table yield single-cell ERK activity time series (ERKATS)
(Figure5A). Several short tracks are still present in the
dataset,whichmaystemfromerrorsincellsegmentationor
simply from cells dying during the acquisition (Figure5B).
To perform detrending and binarisation of ERKATS in
the next section, we remove time series shorter than 5h
(Figure5C).Thisstepisrequiredfordetrendingthatapplies
along-termmedianﬁlterwitha2hwindow.Forawindow
ofthatsize,timeseriesofatleasttwicethewindowlength
arerecommended.
2.6 Collectiveevents
Before we identify collective ERK signalling events with
ARCOS, we need to further process ERKATS to remove
long-term trends in ERK activity and to identify ERK activ-
ity periods, which is the required input for our algorithm.
Detrending works in two steps: (1) apply a short-range
median ﬁlter with a 3-time-point window to remove high-
frequency oscillations and incidental peaks due to exper-
imental noise, (2) subtract long-term median-smoothed
ERKATS from the time series from step 1. Detrending aims
to remove long-term trends due to photobleaching of ﬂu-
orescent probes, or to remove permanently active cells.
The subsequent thresholding of the detrended signal may
leadtotheidentiﬁcationoflongerpulsesonlyduringtheir
peak activity, thus omitting the leading and the decaying
phase of the pulse (Figure6A). Both detrending and bina-
risation, can be performed using a convenience method
bin_measurements fromthe arcos4py packagethatoper-
atesontheARCOSobjectdeﬁnedas:
wheredf_tracks_long isapandasdataframewithsingle-
cell time series obtained from tracking and ﬁltering by
length,andtheremainingparametersdeﬁnenamesofrel-
evant columns, i.e.,x & y positions, frame number, track
identiﬁer, measurement of the cytoplasmic/nuclear ratio,
and cluster identiﬁer that will be determined in the next
steps.
Withthefollowingcode,andsmoothingandthreshold-
ingparameters,detrendedandbinarisedERKATSareadded
as two additional columns to the input data frame with
suffixesresc andbin,respectively:
Figure5: Celltracking.(A)Theresultofcelltrackingovertimewithbtrack.Eachlinecorrespondstoasinglecellanditsspatio-temporalposition.(B)
Sample200single-celltrajectoriesprojectedalongthe X axis.Noteseveralshorttracks.(C)Histogramoftracklengths.Averticaldashedlineata5h
markindicatesacut-off,belowwhichshorttrajectoriesarediscarded.
M.Dobrzyńskietal.:Quantificationofcollectivesignalling — 25
Figure6: Collectiveevents.(A)Sampledetrendedandbinarisedsingle-cellERKATScalculatedfromthecytoplasmic/nuclearERK-KTRratio,C/N
ERK-KTR.ThebinarisedactivitydataindicatedbyredsegmentsistheinputforARCOS.TheplotobtainedwithplotOriginalDetrendedfromthe
arcos4pypackage.(B)NoodleplotvisualisesCEsidentifiedbyARCOSbyprojectingthemonspace-timeaxes.Eachclusterofidenticallycolouredlines
correspondstoasingleCE,witheachlineindicatingwhenasinglecellparticipatesintheCE.TheplotobtainedwithNoodlePlotfromthearcos4py
package.(C)DurationversusthemeantotalnumberofuniquecellsinaCE,i.e.,“thetotalsize”ofaCE.Thereddotindicatesthemedianstatistics.
(D–E)Distributionsofstatisticscalculatedfrom200randomisationiterationscomparedtotheobservedstatisticsindicatedbytheverticaldashedline:
themeantotalsizeofCEs(D),andthemeandurationofCEs(E).The p-valuewascalculatedasthefractionofcaseswhenthestatisticwasatleastas
extremeasobserved.
where smoothK and biasK are window lengths in time
points of the short- and long-term median ﬁlters, respec-
tively;peakThr isathresholdfordetectingpeaksinasignal
rescaledto[0,1]; binThr isathresholdforﬁnalsignalbina-
risation;biasMet is a name of the detrending method. We
recommendtestingseveralsmoothing/thresholdingparam-
etersandverifyingtheresultsgraphicallytoobtainthebest
outcome.
Atlast,collectiveevents(CEs)aredetectedandtracked
fromERKATSwiththecodebelow:
where eps is the search radius in pixels for spatial
clustering in individual frames with DBSCAN;minClsz is
theminimumnumberofcellsthatcomprisespatialclusters
identiﬁedbyDBSCAN;nPrev isthenumberofprevioustime
frameswhichareusedtolinkspatialclustersinthecurrent
timepoint.Thechoiceofthesearchradiusdependsoncell
densityandthesizeofclustersofactivecells.Ifsettoolarge,
nearbyindependentCEsareincludedinasinglecluster;too
small,andasingleCEisidentiﬁedasseveralsmallerevents.
Autilityfunction estimate_eps fromthe arcos4py.tools
module helps to estimateeps based on nearest neighbour
distances:
The function returns the plot of sorted nearest neigh-
bour distances and the mean, which for our dataset
amountsto44pixels(14.3 μm).Consideringthevariabilityin
cell-celldistances,weassumethesearchradiusepstobe100
pixels, or 32.5μm, which is approximately twice the mean
nearest neighbour distance. When testing smaller values
26 — M.Dobrzyńskietal.:Quantificationofcollectivesignalling
of eps and after inspecting them against raw ERK activity
imagesinthenapariimageviewer,weobtainedfragmented
CEsthatshouldbelongtoasingleevent.Conversely,larger
eps yielded CEs that were assigned a single identiﬁer but
stemmedfromseveralindependentevents.
Thenoodleplotisaconvenientvisualisationofcollec-
tiveeventsprojectedontoa2Dspace-timeplane( Figure6B).
Each trace corresponds to a single cell involved in a CE
identiﬁed by the algorithm, and CEs are coloured by their
identiﬁer. TheSupplementaryVideo1 visualises identiﬁed
CEsintherawtime-lapse.
2.7 Validation
Statistics such as the mean duration of CEs or the mean
totalnumberofuniquecellsinvolvedinCEs,i.e.,“themean
total size”, can be computed from the output of ARCOS
(Figure6C). These observed statistics of CEs can be further
testedagainstanullhypothesisthattheydonotdifferfrom
thestatisticsofCEscalculatedinasystemwithanequivalent
total ERK activity, but with the activation occurring ran-
domly in space and time. The ARCOS package implements
5 randomisation methods to simulate the null hypothesis
with varying assumptions. Here, we randomise the time
series by shuffling them in space between initial spatial
positions of existing time series (cf. Figure S1B in [8]). This
methodrandomisesonlythespatialcomponentwhilecon-
serving individual cells’ measurement dynamics and the
population-averaged activity over time. By computing the
samestatisticsfromtherandomiseddata,wecanthencal-
culate thep-value, which is the fraction of cases when the
statisticwasatleastasextremeastheobservedstatistic.
After importing validation module from the arcos4py
package,werandomisethetimeseries:
and calculate the statistics from independent randomisa-
tioniterations:
Both functions have the option to execute the calcula-
tioninparallelbysettingtheparameterparallel_processing
to True. After repeating the randomisation 200 times, on
average,theCEsinvolvedfewercellsandwereshorter-lived
thantheobservedaveragestatistics(Figure6DandE ).Since
none of the test statistics were at least as extreme as the
observed statistic, thep-values for the duration and total
sizewere:
p = Pr(T ≥ t|H0 istrue) = 1+#{tr ≥ t}
Nr +1 = 1
201, (1)
whereT istheteststatistic, t istheobservedvalueofthetest
statistic, Nr is the number of independent randomisations
from which we obtain the valuestr of the test statisticT
[29]–[31].
2.8 Exportingdata
Data can be exported at every stage of the analysis. For
example, NumPy arrays with labelled masks can be saved
ascompressedbinaryﬁles:
andpandasdataframescanbeexportedtocompressed
CSVﬁles:
Thecurrentnapariviewwithblendedvisiblelayerscan
besavedasanRGBTIFFstackusingthenapari-timestamper
package[32]:
3 napariUI
Asanalternativetotheprogrammaticapproachdescribed
so far, the entire workﬂow can also be run interactively
with the napari ARCOS plugin [33]. Here, we outline the
steps required to identify collective signalling events from
raw microscopy images, and the accompanying screen-
cast demonstrates each step in the UI (Supplementary
Video2).
First, the following plugins must be installed through
thenaparipluginmanager:
M.Dobrzyńskietal.:Quantificationofcollectivesignalling — 27
1. stardist-napari,
2. btrack,
3. napari-assistant,
4. napari-segment-blobs-and-things-with-membranes,
5. napari-pyclesperanto-assistant,
6. napari-skimage-regionprops,
7. arcos-gui.
Installationinstructionsforindividualpluginscanbefound
onthenaparihub.Notethatitisrecommendedtoinstallthe
napari-assistantviaoneofthepluginsthatuseitasagraph-
ical user interface. Therefore, we recommend installing
devbio-napari[34],whichbundlesmanyoftheseplugins.
3.1 Pre-processing
We begin the analysis by loading the images into napari.
If they are in a standard format, such as TIFF ﬁles, no
additional plugin must be installed. For other ﬁle formats,
e.g.,NIKONnd2,orLeicalif,speciﬁcplugins,suchasnapari-
aicsimageio,canbeemployed.
Intheexamplepresentedhere,TIFFstacksfornuclear
andERKchannels,areloadedintonapari,andthecontrast
isadjustedtovisualisetheindividualimagesproperly.The
goal is to generate the same two segmentation masks as
before, i.e. the ring mask and the nuclear mask, used to
measure the ﬂuorescence intensity of the ERK-KTR in the
ring and nucleus respectively. As in the Jupyter notebook
pipeline, we use StarDist to segment the nuclear channel.
Openthestardist-napari pluginandconﬁrmthat:
1. Thecorrectimageisselected,
2. The“ModelType”issetto2D,
3. The“Versatile”(ﬂuorescentnuclei)modelisselected,
4. Theaxisorderissetto TYX.
Click on “run” to segment the nuclear channel. Once the
plugin has ﬁnished processing the image stack, it returns
thenuclearsegmentationasalabelslayerandaddsittothe
viewer.
To create a cytosolic ring, we use thenapari-assistant.
Saidpluginprovidesasimpleinterfacetosetupimagepro-
cessing workﬂows. The pluginsnapari-segment-blobs-and-
things-with-membranes andnapari-pyclesperanto-assistant,
provide functions that can be accessed from within the
napari-assistant. To use the assistant ecosystem, images
must adhere to a standard order of time and space dimen-
sions for inter-plugin communication to work properly.
Speciﬁcally,imagestacksmusthavetheshape TZYX,where
T isthetimeand ZYX arespatialdimensions.Ourdatacom-
prises 300 time points (frames), 1, 024×1, 024 pixels each.
Thecorrectdimensionorderforthe napari-assistant isthus
“300,1,1024,1024”.Sofar,alllayersinthenapariviewerwere
loaded asTYX, which outwardly appears to be the same
as a 3D stack with the shapeZYX. For the plugin to treat
ourstackasatime-lapse,anadditional,dummydimension
Zneeds to be inserted. Thenapari-assistant also installs a
utilityplugin napari-time-slicer toperformthisconversion.
We open a widget calledConvert 3D stack to 2D time-lapse
fromthe“Tools > Utilities”sectionandprocesseverylayer
withit.Thereafter,allthesourcelayerscanbediscarded.
We can now set up a workﬂow that will generate the
ring mask. We use the following functions in the order as
shownbelow:
1. ProcessLabels > ExpandLabels;4pixel,
2. ProcessLabels > ReduceLabelstoLabelEdges,
3. ProcessLabels > ExpandLabels;2pixel.
Thesearchbaratthetopofthepluginwindowcanbeused
to quickly ﬁnd the corresponding functions in the napari-
assistant. As input for the ﬁrst function, select the nuclear
segmentation;forthesecond,selecttheoutputfromtheﬁrst
function,andsoonuntilaringisgenerated.
Usingthe napari-skimage-regionprops plugin,wemea-
sure the mean intensity for the nuclear mask and the ring
mask in the ERK-KTR channel. In the “Tools” sub-menu,
select “Measurement tables> Regionprops of all frames”.
Choose “Intensity” and “Position”. Run this twice, once for
thering,andonce forthenuclear segmentation mask.The
outputfromthisplugingetsattachedtotherespectivelabels
layer.
The btrack plugin can be used on the nuclear mask
to track our cells. Tracked cells are not required for the
analysiswithARCOS;However,theyenablemoreadvanced
detrending and data analysis down the line. Simply open
the plugin and click on “Track”. This will add a “tracks”
layertonapari,wherewecanvisuallyconﬁrmthetracking
accuracy.
3.2 Detectcollectiveevents
Once we have the measurements for nuclear and cytosolic
intensity of the ERK-KTR, we can now load the data into
ARCOS and proceed from there. Open thenapari ARCOS
plugin, then in the ﬁrst tab, choose the “Load Data From
Layers” option. In the selection box, choose both labels-
layers that were used to measure cytosolic and nuclear
intensity,andifnucleiweretrackedusing btrack,selectthe
tracks layer in the menu below. Click on “Load Data” and
setthenamesofthecolumnsinthenewlyopeneddialogue.
The individual measurements are named after the layers
they originate from and what they contain. To calculate
the cytosolic to nuclear ratio, in the “Math on ﬁrst and
28 — M.Dobrzyńskietal.:Quantificationofcollectivesignalling
second Measurement” row choose “Division”, then set the
correspondingvaluesinthedialogueboxasﬁrstandsecond
measurement.Conﬁrmthechoicesbyclickingon“OK”and
thenselectthe“ARCOSparameters”tab.Here,setappropri-
ate parameters for your dataset. The epsilon value can be
estimatedbasedontheinputdata.However,inourexample,
we set it manually. Use the same parameters as outlined
intheprogrammaticapproachbefore.Sincewepreviously
converted ourTYX image stack to aTZYX s t a c kb ya d d i n g
a Z dimension with size 1, we need ARCOS to also output
this dimension order. To achieve this, set the “Output Axis
Order”ﬁeldjustbelowthelastARCOSparametersto“ tzyx”,
thenclickon“runARCOS”.Aseriesoflayerswillbeaddedto
the viewer, containing the detected collective events, their
convex hulls, as well as which cells were deemed to be
active.
The napari ARCOS plugin provides several interactive
plotsandtoolsthathelpwithinspectingandanalysingdata.
Additionally, the parameters used for the analysis, as well
as the output and statistics, can be exported, to be used
for further analysis and visualisation. The current napari
view with blended layers can be exported to an RGB TIFF
stack or an MP4 video using a convenient plugin,napari-
timestamper [32].
4 Discussion
Wedescribedtwosingle-programming-environmentwork-
ﬂowstoprocesstime-lapseimagesofﬂuorescentbiosensors
to extract dynamic collective signalling events. We applied
themtoanalysewavesofERKactivitythataretriggeredby
apoptoticcellsinepithelialcellularcommunities[ 1].These
wavesareonlyoneofmanyexamplesofsimilaremergent
phenomenathathaverecentlybeendescribed[ 35],[36]due
totheexpansionofﬂuorescentbiosensortechnologiesand
accurate single-cell measurements [37]. We used ARCOS to
identify collective events with different sizes, shapes, and
durations, in MCF10A, NRK-52E and MDCK cell lines in 2D
cell cultures [1], [8] and in 3D MCF10A acini [4]. Other
groups applied our method to waves of calcium activity
in neutrophils [38] and in blood progenitors of a wild-type
lymphgland[ 39],aswellasERKactivitywavesinbronchial
epithelial cell lines HBE1 and 16HBE [35]. In addition to
ﬂuorescencemicroscopyimagesof in vitro cellcultures,we
used ARCOS to identify collective motion in giant honey
bee colonies that employ this visual signal to deter preda-
tor wasps [8]. The statistics extracted from our analysis
canguidetheinvestigatorstobetterinterprettheobserved
phenomena.Forinstance,whenmultipleeventsareoccur-
ring at the same time, it is not trivial to distinguish, just
by looking at microscopy time-lapses, actual coordinated
events from random ﬂuctuation happening close to each
otherinspaceandtime.Bycomparingthestatisticsofmea-
suredcollectiveeventswitharandomisedcounterpart,itis
instead possible tostatistically test thehypothesis whether
theobservedcollectiveeventsemergefromstochasticﬂuc-
tuationsofsignallingactivity.
Asidefromtheapplicationtothediscoveryofdynamic,
collective, emergent behaviour in different biological sys-
tems, our method can be further applied to automatise
the screening of several experimental conditions. One
such example is the identiﬁcation of molecular mecha-
nisms of collective events’ propagation, which requires
high throughput screening with RNAi or small molecule
inhibitors. The multicore parallelisation of our pipeline’s
code enables scaling up the analysis to high-performance
computing(HPC)clusters,furtherfacilitatingtheanalysisof
largescreeningdatasets.
Furthermore, clinical research applications that study
pathological alterations of collective signalling across mul-
tiple conditions could also beneﬁt from our method. We
previously observed that two common oncogenic muta-
tions strongly alter single-cell and collective signalling [8].
This suggests that the alteration of collective signalling is
a property of cancer, and might drive cancer progression.
Ourmethodhasthepotentialtoidentifychangesincollec-
tivesignallingdynamics,evenindisorganisedpathological
systemswherecollectivesignallingeventscannotbeeasily
identiﬁedbyeye.
Supplementarydata
The following supplementary materials accompany this
manuscript:
– Supplementary File 1 : two TIFF image stacks with
nuclearandERK-KTRchannels(1.2GB).
– Supplementary File 2 : Jupyter notebook with Python
code to perform the entire analysis and reproduce all
theplotsfromthemanuscript(3.5MB).
– Supplementary File 3 : YAML ﬁles to conﬁgure
conda/mamba Python environments for macOS,
WindowsandLinux.
– Supplementary File 4:JSONﬁlewiththeparticletrack-
ingmodelforbtrack.
– Supplementary Video 1 : an MP4 video of collective
ERKactivitywavesidentiﬁedwithARCOSandtheani-
matednoodleplot(42MB).
– Supplementary Video 2 :anMP4 videowithascreen-
cast of steps required to perform the analysis in the
napariimageviewer(112MB).
M.Dobrzyńskietal.:Quantificationofcollectivesignalling — 29
Supplementary Files 1–4 were uploaded to Mendeley
Data[10]andﬁles2–4toGitHub[ 13]repositories.
Acknowledgement: We would like to thank J.S. Brugge
(Department of Cell Biology, Harvard Medical School) for
MCF10AWTcells.
Researchethics:Notapplicable.
Author contributions:The authors have accepted respon-
sibility for the entire content of this manuscript and
approveditssubmission.CRediTauthorcontributionsstate-
mentDobrzyńskiM:Conceptualization;Writing – Original
Draft, Writing – Review and Editing, Software, Visualiza-
tion,DataCuration.GrädelB:Writing–OriginalDraft,Writ-
ing–ReviewandEditing,Software,Visualization.Gagliardi
PA:Writing – OriginalDraft,Writing – ReviewandEditing,
Investigation,Visualization.PertzO:Writing – Reviewand
Editing,Fundingacquisition.
Research funding:This work was supported by Swiss
NationalScienceFoundationgrants31003A-163061,51PHPO-
163583,Div3310030_185376,IZKSZ3_62195,byaSwissCancer
League grant KLS-4867-08-2019, and by a Human Frontier
Science Program grant RGP0043/2019 to O. Pertz, and by a
ChanZuckerbergInitiativenapariPluginFoundationGrant
2022-252527toM.DobrzyńskiandB.Grädel.
References
[1] P.A.Gagliardi, et al.,“CollectiveERK/Aktactivitywavesorchestrate
epithelialhomeostasisbydrivingapoptosis-inducedsurvival,” Dev.
Cell,vol.56,no.12,pp.1712 −1726.e6,2021..
[2] T.J.Aikin,A.F.Peterson,M.J.Pokrass,H.R.Clark,andS.Regot,
“MAPKactivitydynamicsregulatenon-cellautonomouseffectsof
oncogeneexpression,” eLife,vol.9,2020,Art.no.e60541. .
[3] Y.Takeuchi, et al.,“Calciumwavepromotescellextrusion,” Curr.
Biol.,vol.30,no.4,pp.670 −681.e6,2020..
[4] P.Ender, et al.,“SpatiotemporalcontrolofERKpulsefrequency
coordinatesfatedecisionsduringmammaryacinar
morphogenesis,”Dev. Cell,vol.57,no.18,pp.2153 −2167.e6,2022..
[5] A.DeSimone, et al.,“Controlofosteoblastregenerationbyatrain
ofErkactivitywaves,” Nature,vol.590,no.7844,pp.129 −133,
2021..
[6] K.Aoki,Y.Kondo,H.Naoki,T.Hiratsuka,R.E.Itoh,andM.
Matsuda,“PropagatingwaveofERKactivationorientscollective
cellmigration,”Dev. Cell,vol.43,no.3,pp.305 −317.e5,2017..
[7] N.Hino, et al.,“ERK-mediatedmechanochemicalwavesdirect
collectivecellpolarization,” Dev. Cell,vol.53,no.6,
pp.646−660.e8,2020..
[8] P.A.Gagliardi, et al.,“Automaticdetectionofspatio-temporal
signalingpatternsincellcollectives,” J. Cell Biol. ,vol.222,no.10,
2023,Art.no.e202207048. .
[9] S.Regot,J.J.Hughey,B.T.Bajar,S.Carrasco,andM.W.Covert,
“High-sensitivitymeasurementsofmultiplekinaseactivitiesinlive
singlecells,”Cell,vol.157,no.7,pp.1724 −1734,2014..
[10] M.Dobrzyński,“Sourcedataandpythonscripts,”2024.Available
at:https://data.mendeley.com/datasets/z29fyn6kzz.
[11] T.Kluyver, et al.,“Jupyternotebooks − apublishingformatfor
reproduciblecomputationalworkflows,”in Positioning and Power
in Academic Publishing: Players, Agents and Agendas ,F.Loizides,and
B.Schmidt,Eds.,IOSPress,2016,pp.87 −90.
[12] G.VanRossumandF.L.Drake,Jr., Python Reference Manual ,
Amsterdam,CentrumvoorWiskundeenInformatica,1995.
[13] M.Dobrzyński,“Sourcepythonscripts,”2024.Availableat: https://
github.com/dmattek/ARCOS-tutorial.
[14] N.Sofroniew, et al.,“napari/napari:0.4.15rc1,”2022.Availableat:
https://zenodo.org/record/3555620.
[15] B.Grädel,“arcos4py:automatedrecognitionofcollective
signallingforpython,”2024,Availableat: https://github.com/
bgraedel/arcos4py.
[16] C.R.Harris, et al.,“ArrayprogrammingwithNumPy,” Nature,
vol.585,no.7825,pp.357 −362,2020..
[17] W.McKinney,“Datastructuresforstatisticalcomputingin
Python,”in Proceedings of the 9th Python in Science Conference ,S.
vanderWalt,andJ.Millman,Eds.,2010,pp.56 −61.
[18] C.Gohlke,“tifffile,”2024.Availableat: https://doi.org/10.5281/
zenodo.10651760.
[19] JoblibDevelopmentTeam,“Joblib:runningpythonfunctionsas
pipelinejobs,”2020.Availableat: https://joblib.readthedocs.io/.
[20] U.Schmidt,M.Weigert,C.Broaddus,andG.Myers,“Celldetection
withstar-convexpolygons,”in Medical Image Computing and
Computer Assisted Intervention − MICCAI 2018 − 21st International
Conference, Granada, Spain, September 16-20, 2018, Proceedings, Part
II,2018,pp.265 −273.
[21] M.WeigertandU.Schmidt,“Nucleiinstancesegmentationand
classificationinhistopathologyimageswithstardist,”in The IEEE
International Symposium on Biomedical Imaging Challenges (ISBIC) ,
2022.
[22] M.Weigert,U.Schmidt,R.Haase,K.Sugawara,andG.Myers,
“Star-convexpolyhedrafor3dobjectdetectionandsegmentation
inmicroscopy,”in The IEEE Winter Conference on Applications of
Computer Vision (WACV) ,2020.
[23] S.VanderWalt, et al.,“scikit-image:imageprocessinginpython,”
PeerJ,vol.2,p.e453,2014. .
[24] Open-sourcecommunity,“py-clesperanto:amulti-language
frameworkforGPU-acceleratedimageprocessing,”2024.
Availableat:https://pypi.org/project/pyclesperanto/.
[25] K.Ulicna,G.Vallardi,G.Charras,andA.R.Lowe,“Automateddeep
lineagetreeanalysisusingabayesiansinglecelltracking
approach,”Front. Comput. Sci. ,vol.3,p.92,2021. .
[26] J.D.Hunter,“Matplotlib:a2dgraphicsenvironment,” Comput. Sci.
Eng.,vol.9,no.3,pp.90 −95,2007..
[27] QuantStack,“Mamba:afast,robust,andcross-platformpackage
manager,”2020,Availableat: https://mamba.readthedocs.io.
[28] L.P.Coelho,“Mahotas:opensourcesoftwareforscriptable
computervision,” J. Open Res. Softw. ,vol.1,no.1,p.e3,
2013..
[29] A.C.DavisonandD.V.Hinkley, Bootstrap Methods and their
Application,CambridgeUniversityPress,2013.
[30] P.Good, Permutation, Parametric and Bootstrap Tests of Hypotheses ,
NewYork,SpringerSeriesinStatistics.Springer-Verlag,2004.
[31] B.F.J.ManlyandJ.A.NavarroAlberto, Randomization, Bootstrap,
and Monte Carlo Methods in Biology. Texts in Statistical Science ,4th
ed.BocaRaton,FL,Chapman&Hall/CRC,2022.
30 — M.Dobrzyńskietal.:Quantificationofcollectivesignalling
[32] B.Grädel,“Naparitimestamperplugin,”2024.Availableat:
https://github.com/bgraedel/napari-timestamper.
[33] B.Grädel,“ARCOSnapariGUI,”2024.Availableat: https://www
.napari-hub.org/plugins/arcos-gui.
[34] R.Haase,“devbio-napari:abundleofnaparipluginsusefulfor
3D+timageprocessingandanalysisforstudyingdevelopmental
biology,”2024.Availableat: https://www.napari-hub.org/plugins/
devbio-napari.
[35] N.L.DeCuzzi, et al.,“SpatiotemporalclustersofERKactivity
coordinatecytokine-inducedinflammatoryresponsesinhuman
airwayepithelialcells,”bioRxivpreprint,2024,https://doi.org/10
.1101/2024.02.03.578773.
[36] K.W.Pond, et al.,“Live-cellimaginginhumancolonicmonolayers
revealsERKwaveslimitthestemcellcompartmenttomaintain
epithelialhomeostasis,”eLife,vol.11,2022,Art.no.e78837. .
[37] E.C.Greenwald,S.Mehta,andJ.Zhang,“Geneticallyencoded
fluorescentbiosensorsilluminatethespatiotemporalregulationof
signalingnetworks,”Chem. Rev.,vol.118,no.24,pp.11707 −11794,
2018..
[38] E.Strickland, et al.,“Self-extinguishingrelaywavesenable
homeostaticcontrolofhumanneutrophilswarming,”bioRxiv
preprint,2023.https://doi.org/10.1101/2023.06.27.546744.
[39] S.B.David,K.Y.Ho,G.Tanentzapf,andA.Zaritsky,“Formationof
recurringtransientca2 +-basedintercellularcommunitiesduring
drosophilahematopoiesis,”bioRxivpreprint,2023. https://doi
.org/10.1101/2023.11.25.568594.
Supplementary Material:This article contains supplementary material
(https://doi.org/10.1515/mim-2024-0003).