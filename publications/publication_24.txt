 
1 
Optogenetic actuator/biosensor circuits for large-scale interrogation of ERK 
dynamics identify sources of MAPK signaling robustness. 
  
 
  
Coralie Dessauges 1, Jan Mikelson 2, Maciej Dobrzyński 1, Marc -Antoine Jacques 1, 
Agne Frismantiene1, Paolo Armando Gagliardi1, Mustafa Khammash2, Olivier Pertz1 
  
1Institute of Cell Biology, University of Bern, Baltzerstrasse 4, 3012 Bern, Switzerland 
2Department of Biosystems Science and Engineering, ETH Zurich, Mattenstrasse 26, 
4058 Basel, Switzerland 
 
Abstract 
  
 
Measurements of single -cell ERK activity dynamics provide unique insights in the 
MAPK network topology. We built genetic circuits consisting of optogenetic actuators 
activating ERK from different nodes within the MAPK network together with an ERK 
biosensor to measure single -cell ERK dynamics. Evaluating ERK dynamics induced 
by different temporal optogenetic inputs, in response to a large number of 
perturbations, shows that the MAPK network is robust to downregulation of most of its 
nodes. This robust ness emerges in part because of the ERK -RSK2-SOS negative 
feedback. Bypassing this feedback, by direct activation of the RAS/RAF/MEK/ERK 
submodule, or by RSK2 perturbation, breaks MAPK network robustness. Targeting 
the RSK2 -mediated feedback in a ErbB2 -dependent oncogenic signaling model 
greatly sensitizes ERK to MEK inhibition, allowing efficient ERK activity shutdown 
within a cell population. Thus, the RSK2-mediated negative feedback is a weak node 
of the MAPK network whose perturbation enables potent inhibition of ERK.  
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
2 
 
Introduction 
  
The extracellular signal-regulated kinase (ERK) is part of the mitogen-activated protein 
kinase (MAPK) signaling network and regulates a large variety of fate decisions. While 
ERK can be activated by several extracellular inputs, ERK signaling has mostly been 
studied in the context of receptor tyrosine kinases (RTKs). Upon binding of their 
cognate growth factors (GFs), RTKs activate a complex signaling cascade with the 
following hierarchy: (1) recruitment of adaptor molecules such as GRB2 (Schlessinger, 
2000), (2) activation of RAS GTPases through Guanine nucleotide exchange factors 
(GEFs) and GTPase activating proteins (GAPs) (Cherfils and Zeghouf, 2013) , (3) 
triggering of a tripartite RAF, MEK, ERK kinase cascade that is further regulated by a 
variety of binding proteins (Lavoie et al., 2020), (4) ERK-mediated phosphorylation of 
a large number of substrates. Due to its central role in fate decisions, MAPK network 
dysregulation is causative for a large number of diseases including cancer (Rauen, 
2013; Samatar and Poulikakos, 2014).  
As for other signaling pathways (Purvis and Lahav, 2013) , ERK activity dynamics 
rather than steady states control fate decisions (Albeck et al., 2013; Avraham and 
Yarden, 2011; Ryu et al., 2015; Santos et al., 2007) . Specific ERK activity dynamics, 
hereafter referred to as ERK dynamics, have been shown to arise from feedbacks in 
the MAPK network. For example, negative feedback from ERK to RAF produces 
adaptive or oscillatory ERK dynamics (Avraham and Yarden, 2011; Kholodenko et al., 
2010; Santos et al., 2007) . Negative feedbacks also provi de network robustness, 
allowing for high fidelity signal transmission in response to noisy environmental inputs 
and noise in MAPK network node expression level (Blüthgen and Legewie, 2013; 
Fritsche-Guenther et al., 2011; Sturm et al., 2010) . While several negative feedback 
loops have been mapped experimentally in the MAPK network (Lake et al., 2016) , 
their role in shaping ERK dynamics remains largely unknown. 
Single-cell biosensor imaging has provided new insights into MAPK signaling that 
were not accessible with biochemical, population -averaged measurements. T his 
showed that the MAPK network can produce a wide variety of ERK dynamics such as 
transient (Ryu et al., 2015) , pulsatile (Albeck et al., 2013) , oscillatory (Shankaran et 
al., 2009) and sustained dynamics (Blum et al., 2019; Ryu et al., 2015) , which partly 
explains how a single pathway can control different fates. Mathematical modeling has 
provided insight into the network structures that allow decoding of different inputs into 
specific ERK dynamics (Nakakuki et al., 2010; Ryu et al., 2015; Santos et al., 2007; 
Shankaran et al., 2009) . Combined modeling/experimental approaches captured 
emergent properties of MAPK subnetworks, including the epidermal growth factor 
receptor (EGFR) module (Koseska and Bastiaens, 2020), the RAS module (Erickson 
et al., 2019; Schmick et al., 2015) , and the tripartite RAF/MEK/ERK cascade (Arkun 
and Yasemi, 2018; Ferrell and Bhatt, 1997; Kholodenko, 2000; Kochańczyk et al., 
2017; Orton e t al., 2005; Ryu et al., 2015; Santos et al., 2007) . However, the low 
experimental throughput to measure ERK dynamics, or other MAPK network nodes, 
has precluded a global understanding of the specific functions of the nodes present in 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
3 
the network. Here, we  built genetic circuits consisting of optogenetic actuators to 
activate ERK from different nodes in the MAPK network, together with an ERK 
biosensor to measure single -cell ERK dynamics. This allowed us to challenge cells 
with highly defined temporal inputs  and to explore ERK dynamics that result from 
different MAPK subnetworks. RNA interference (RNAi) screening of 50 signaling 
nodes revealed that the MAPK network is robust against perturbations of many of its 
nodes. We found that this emerges, in part, beca use of the previously documented 
ERK/RSK2/SOS negative feedback. We show that perturbation of this feedback can 
weaken the MAPK network in an oncogenic signaling model, allowing to sensitize ERK 
activation to MEK inhibition, and to robustly shut down ERK activity in all the cells of a 
population. Thus, identification of the MAPK feedback circuitry provides a rationale to 
weaken the MAPK network for potent pharmacological inhibition of ERK in cancer. 
  
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
4 
Results  
An optogenetic actuator-biosensor genetic circuit to study input -dependent 
ERK dynamics 
In order to measure ERK dynamics in response to dynamic RTK inputs, we built a 
genetically-encoded circuit made of an optogenetic RTK actuator and an ERK 
biosensor (Figure 1A). We cho se optoFGFR, which consists of a myristoylated 
intracellular domain of the fibroblast growth factor receptor 1 (FGFR1) fused to a CRY2 
domain (Kim et al., 2014). Upon stimulation with blue light, optoFGFR dimerizes and 
trans-autophosphorylates, leading to the activation of the MAPK/ERK, 
phosphoinositide 3 -kinase (PI3K)/AKT, and phospholipase C (PLC)/Ca 2+pathways. 
We used ERK -KTR-mRuby2 as an ERK biosensor that is spectrally orth ogonal to 
optoFGFR. ERK -KTR reversibly translocates from the nucleus to the cytosol upon 
ERK activation (Regot et al., 2014). We used a nuclear Histone 2 B (H2B)-miRFP703 
marker to identify and track single cells. These constructs were stably inserted into 
murine NIH3T3 fibroblasts. We then used automated time -lapse microscopy to 
stimulate selected fields of view with defined blue light input patterns to activate 
optoFGFR and re cord the corresponding ERK -KTR/H2B signals with a 1 -minute 
temporal resolution. We observed that a 100 ms light pulse leads to reversible ERK -
KTR translocation from the nucleus to the cytosol, indicative of transient ERK 
activation (Figure 1B, Movie S1). We built a computer vision pipeline to automatically 
track each nucleus, and compute ERK activity as the cytosolic/nuclear ratio of the 
ERK-KTR signals (Figure 1C). At the end of an experiment, we quantified optoFGFR 
expression levels using a fused mCitrine  fluorophore. This allows us to correlate 
single-cell ERK responses to optoFGFR expression levels. We evaluated the 
sensitivity and specificity of our system with dose response experiments using the 
FGFR inhibitor SU5402, the RAF inhibitor RAF709, the MEK inhibitor U0126 and the 
ERK inhibitor SCH772984 (Figure S1A). The quantification of optoFGFR dimerization 
kinetics revealed a dissociation time of 5 minutes, assumed to reflect its signaling 
duration (see Text S1, Figure S1B,C, Movie S2). A short ERK inact ivation period 
manifesting as a dip in the ERK response was observed directly after the light input . 
We have shown that this dip results from the dephosphorylation of ERK -KTR by 
Calcineurin, a phosphatase activated by optoFGFR -dependent Ca2+ signaling (Text 
S1, Figure S1D-F). 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
5 
  
Figure 1: An optogenetic actuator -biosensor genetic circuit to study input -dependent ERK 
dynamics. (A) Schematic representation of the optoFGFR system consisting of the optogenetic FGF 
receptor (optoFGFR) tagged with mCitrine, the ERK biosensor (ERK-KTR) tagged with mRuby2 and a 
nuclear marker (H2B) tagged with miRFP703. (B) Time lapse micrographs of ERK -KTR dynamics in 
response to a 470 nm transient light pulse. ERK-KTR and H2B channels were acquired every 1 minute 
and the optoFGFR channel at the end of the experiment using a 20x air objective. Scale bar: 50 μm. 
(C) Image analysis pipeline developed to quantify single -cell ERK responses. Nuclear and cytosolic 
ERK-KTR signals were segmented based on the H2B nuclear mask. Single-cell ERK activity was then 
calculated as the cytosolic/nuclear ERK-KTR ratio. Single-cell optoFGFR intensity was measured under 
the cytosolic ERK-KTR mask and used as a proxy for optoFGFR expression level.  
Transient, oscillatory and sustained  ERK activity are triggered by different 
optoFGFR inputs 
Next, we characterized optoFGFR -triggered ERK dynamics in response to a single 
light pulse of different intensities and durations (Figure 2A). As ERK dynamics 
depended on light power density and pulse duration, we defined the light dose (D, 
mJ/cm2) as the product of both to quantify the total energy received per illuminated 
area. To characterize ERK dynamics, we extracted the amplitude at the maximum of 
the peak (maxPeak), and the full width at half maximum (FWHM) of the ERK 
trajectories (Figure 2B). With i ncreasing light doses, ERK peaks increased both in 
duration and amplitude, until the latter reached saturation. Based on these 
observations, we selected 180 mW/cm2 and 100 ms (D = 18 mJ/cm 2) as the minimal 
light input to generate an ERK transient of maxima l amplitude. Using this light dose, 
we then investigated ERK dynamics in response to multiple light pulses delivered at 
different intervals (Figure 2C). Repeated light inputs applied at 10 - or 20 -minutes 
intervals evoked population -synchronous ERK transien ts. In contrast, repeated light 
A
C
B
FGFR
cyto
FGFR
cyto
SOS
MEK
GRB2
FRS2
RAF
RAS
ERK
P
ERK-KTR
ERK-KTR
ERK inactive ERK active
H2B
-5 min +5 min +10  min +15 min +30 min
ERK-KTR
mRuby2
H2B
miRFP703
optoFGFR
mCitrine
Post time-lapse
t
ERK-KTR 
segmentation
- Single cell tracking
- Full-length trajectories selection
- Receptor intensity matching
ERK-KTR
optoFGFR
H2B
optoFGFR 
segmentation
0 10 20 30 40
0.5
1.0ERK activity
Time [min]
Single cell
Average
Light input
Nuc
Cyto
Nuc
Cyto
Intensity (log10)
Density
optoFGFR distribution
P
P
P
P
P
Fig.1
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
6 
inputs applied at higher frequencies (2 -minutes intervals) led to sustained ERK 
dynamics. Given CRY2’s 5-minutes dissociation half-life (Figure S1B,C) (Duan et al., 
2017), this suggests that light pulses delivered at a 2 -minutes interval reactivate 
optoFGFR faster than it deactivates, leading to sustained optoFGFR activity. 
Hierarchical clustering of ERK responses to sustained optoFGFR inputs rev ealed 
sustained and oscillatory single-cell ERK dynamics (Figure 2D). Classification of ERK 
trajectories based on optoFGFR expression revealed that sustained/oscillatory ERK 
dynamics correlated with high/low optoFGFR levels (Figure 2E, Movie S3).  Oscillatory 
ERK dynamics were also observed in optoFGFR high expressing cells in response to 
low light input (Figure 2F). Thus, sustained and oscillatory ERK dynamics can be 
triggered in response to different optoFGFR input strengths - a combination of light 
energy and optoFGFR expression.  
To further understand optoFGFR-evoked ERK dynamics, we compared it to sustained 
FGFR and EGFR inputs. Stimulation with basic FGF led to sustained ERK dynamics 
that exhibited a biphasic behavior in a dose response challenge (Figure S2A,B). This 
was previously shown to emerge from competition of basic FGF for FGFR and heparan 
sulfate proteoglycan co -receptors (Blum et al., 2019) . The ability of optoFGF R to 
trigger different ERK dynamics thus can be explained because of a lack of these 
extracellular interactions. EGF stimulation, on the other hand, induced an ERK 
transient with prominent adaptation (Figure S2C,D), which has been shown to involve 
negative feedback (Avraham and Yarden, 2011; Kholodenko et al., 2010; Santos et 
al., 2007). However, similarly to low optoFGFR input, low FGFR and EGFR inputs 
induced oscillatory ERK behavior. To understand the origin of the oscillatory ERK 
dynamics, as well as the difference in ERK dynamics evoked by EGFR and optoFGFR 
inputs, we sequentially applied EGFR and optoFGFR inputs to the same cells (Figure 
S2E) and observed loss of ERK oscillations upon low optoFGFR input. Mathematical 
modeling of these experiments revealed that ERK oscillations emerge from a 
conserved negative feedback downstream of optoFGFR and EGFR, and that 
optoFGFR lacks receptor -level regulatory mechanisms relevant to the endogenous 
EGFR (Figure S3). These experiments and additional modeling efforts are discussed 
thoroughly in Text S2. While optoFGFR lacks some regulatory mechanisms relevant 
to endogenous RTKs, it faithfully captur es several features of RTK/MAPK signaling. 
This includes the steep increase in ERK activity when the input is applied, the 
characteristic adaptation kinetics observed upon optoFGFR input removal, as well as 
the ability to induce oscillatory ERK dynamics in response to low input. 
 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
7 
 
Figure 2: Transient, oscillatory and sustained ERK activity are triggered by different optoFGFR 
inputs. (A) ERK responses to increasing light power densities and pulse durations of a 470 nm transient 
light input. The light dose “D” is calculated as the product of the power density and pulse duration. (B) 
Quantification of the MaxPeak (maximal ERK amplitude of the trajectory) and the FWHM (full width at 
half maximum, the peak duration at half maxPeak) of single -cell ERK responses shown in (A) (N min = 
40 cells per condition). (C) Cells were stimulated with 470 nm light pulses delivered every 20, 10, 5 and 
2 minutes respectively (D = 18 mJ/cm2). (D) Hierarchical clustering (Euclidean distance and Ward D2 
linkage) of trajectories from the 2-minute interval (referred to as “sustained”) stimulation shown in (C) 
(N = 60 cells). The number of clusters was empirically defined to resolve different ERK dynamics. The 
average ERK response per cluster is displayed on the right. (E) Separation of the trajectories shown in 
(D) in low and high optoFGFR cells, based on the log10 intensit y of optoFGFR -mCitrine. (F) ERK 
responses to increasing doses of sustained optoFGFR inputs. Single-cell ERK trajectories were divided 
in low (top panel) and high (bottom panel) optoFGFR expression. 
 
0 10 20 30 40 0 10 20 30 40 0 10 20 30 400 10 20 30 40
0.0
0.5
1.0
Time [min]
0 mW/cm2 5 mW/cm2 20 mW/cm2 180 mW/cm2
50 ms100 ms1 s
0.0
0.5
1.0
0.0
0.5
1.0ERK activity
A B
C
Time
ERK activity
FWHM
maxPeak
Feature extraction
2 min interval10 min interval20 min interval 5 min interval
ED
ERK trajectories
2 min interval
Dose (D) = 0 mJ/cm2
D = 0
D = 0
D = 0.25
D = 0.5
D = 5
D = 1
D = 2
D = 20
D = 9
D = 18
D = 180
Time [min]
25 50 75525 50 755
ERK activity
25 50 755
0.25
0.50
0.75
1.00
25 50 755
F
0 mJ/cm2 5 mJ/cm2 18 mJ/cm22.5 mJ/cm2
0.0
0.5
1.5
−2.5 −2.0 −1.5
Intensity (log10)
Density
1.0
optoFGFR distribution
Light power density
Light dose
Pulse duration
Clusters
1 32 4
4
3
2
1
Low High
25 50 755
0.5
1.0
Average 
ERK activity
0.25
0.50
0.75
1.00ERK activity
25 50 755
0.25
0.50
0.75
1.00
Time [min]
Low 
optoFGFR 
1.00
0.25
0.50
0.75
1.00ERK activity
0.25
0.50
0.75
20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30
Time [min]
Time [min]Time [min]
0.3
1.2
ERK
activity
FWHM [min] MaxPeak
5 mW/cm2
20 mW/cm2
180 mW/cm2
Power density
50ms 100ms 1s
12
9
6
0.8
1.2
50ms 100ms 1s
0.4
0 mW/cm2
Pulse duration
Oscillatory
Sustained
NANA NANA
Average
Single cell
High
optoFGFR 
Average
Single cell
Low 
optoFGFR 
Average
Single cell
High
optoFGFR 
Average
Single cell
Fig.2
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
8 
Large-scale perturbation of the MAPK network reveals robustness against 
downregulation of its signaling nodes 
To explore the network circuitry that shapes ERK dynamics, we performed an RNA 
interference (RNAi) screen and probed the effect of node perturbations in response to 
sustained optoFGFR input . We used a bioinformatic approach to identif y a potential 
MAPK network  by sequentially querying known interactors of the tripartite 
RAF/MEK/ERK cascade downstream of the FGFR receptor t hat were detected in a 
NIH3T3 proteome (Schwanhäusser et al., 2011) (Figure 3A, Table S4). This network 
consisted of a receptor proximal layer containing adaptors (GRB2, FRS2), negative 
regulators such as Sprouty proteins and protein tyrosine phosphatases, a RAS -
centered layer consisting of GEFs, GAPs, and RAS isoforms, a MAPK-centered layer 
containing MAPK isoforms and scaffold proteins, and a layer of dual specificity 
phosphatases (DUSPs), documented to deactivate different MAPKs (Patterson et al., 
2009). We used the siPOOL technology to specifically knockdown (KD) these 50 
MAPK signaling nodes  while limiting off -target effects (Hannus et al., 2014) . We 
validated KD efficiency by quantifying transcript levels with different siPOOL 
concentrations targeting ERK and MEK isofo rms (Figure S 4A) and observed strong 
KD with 10 nM siRNA concentration. We then evaluated the effect of ERK1 and ERK2 
KD on ERK dynamics. Surprisingly, we observed only subtle phenotypes (Figure 3B), 
even though e fficient KD was observed at protein level ( Figure 3C). However, 
combined ERK1/ERK2 KD suppressed ERK dynamics showing that ERK activation is 
robust to perturbation of individual ERK isoforms as previously reported (Fritsche-
Guenther et al., 2011; Ornitz and Itoh, 2015) . ERK1/ERK2 KD was used as positive 
control, and a non -targeting siRNA was used as negative control  throughout our 
screens. We performed three replicates of the screen. 
We first quantified maximal ERK amplitudes (maxPeak) of cells expressing high 
optoFGFR levels to exclude noisy oscillatory ERK trajectories (Figure 3D). Many KDs 
led to statistically significant, albeit mild, ERK amplitude phenotypes, despite selective 
and efficient KD quantified for several nodes (Figure S4B) . Strongly decreased ERK 
amplitudes were observed for GRB2, ERK2 and RSK2 KD, and an  increase in 
amplitudes was observed for KD of a panel of DUSPs, and some negative regulators 
such as PP2A and Sproutys (Figure 3D). 
We then investigated changes in the shape and heterogeneity of  ERK trajectories. 
Visual evaluation of population-averaged ERK dynamics revealed some penetrant  
phenotypes (Figure S4C,D). However, the high heterogeneity in single-cell trajectories 
precluded the definition of a minimal set of human -defined features to capture all 
possible ERK dynamics phenotypes in an unbiased fashion. To bypass this limitation, 
we used CODEX (Jacques et al., 2021), a data-driven approach to identify patterns in 
single-cell time-series based on convolutional neural networks (CNNs) (Figure S5A). 
We trained a CNN to classify ERK trajectories that originate from different siRNA 
perturbations, irrespectively of optoFGFR expression levels. To identify perturbations 
that induced distinct ERK dynamics, we selected the ten perturbations for which the 
CNN classification accuracy was the highest (Table S4, “CODEX accuracy”). We then 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
9 
trained a second model on those ten perturbations. Projection of the CNN features in 
a t-distributed stochastic neighbor embedding (t-SNE) space revealed well-separated 
clusters of ERK trajectories (Figure S5B). We then displayed the ten trajectories with 
the highest class ification confidence for each perturbation to get intuition about the 
effect of the perturbation on ERK trajectories (Figure 3E, “CODEX”). Comparison with 
randomly selected ERK trajectories for both optoFGFR -low (oscillatory ERK 
dynamics) and optoFGFR -high cells (sustained ERK dynamics) confirmed these 
phenotypes (Figure 3E). As expected, ERK1+ERK2 KD completely inhibited ERK 
activity. KD of the general phosphatase PP2A induced oscillatory behavior with high 
amplitude. RSK2 KD led to strongly decreased osci llatory ERK behavior, slower 
deactivation kinetics upon input removal (Figure S5C), and increased heterogeneity in 
ERK amplitude decreasing population-averaged ERK amplitude. PLCG1 KD resulted 
in shorter ERK peaks, increased oscillatory behavior, as well a s absence of the dip. 
As phospholipase C mediates Ca 2+ signaling in response to FGFR activation  (Ornitz 
and Itoh, 2015), this further validates the role of Ca2+ signaling in formation of the dip 
(Figure S1D-F). ERK2 KD led to a slower ERK activation rate, decreased oscillatory 
behavior and lower overall ERK amplitude. DUSP6 KD led to increased ERK 
amplitude and baseline ERK activity levels (Figure S5C). GRB2 KD, and to a lower 
extent FRS2 KD, led to heterogeneous ERK dynamics with a large cell population not 
being able to produce robust ERK responses, decreasing population -averaged ERK 
amplitude. RAPGEF1 KD led to increased oscillatory behavior in optoFGFR-low cells. 
CRAF KD led to strongly decreased oscillatory behavior, and increased heterogeneity 
in ERK amplitudes. While other perturbations led to subtle changes in ERK 
amplitudes, they did not induce detectable ERK dynamics phenotypes, suggesting that 
the MAPK n etwork is robust against RNAi perturbation of most of its nodes under 
sustained input. 
As our modeling efforts suggest (Figure S3, Text S2), oscillatory ERK behavior might 
emerge from the presence of negative feedback in the MAPK network (Kholodenko, 
2000). Therefore, perturbations decreasing ERK oscillations might identify nodes 
involved in such feedback regulation. We systematically evaluated the proportion of 
oscillatory versus non-oscillatory ERK trajectories in response to each perturbation, 
for both high and low optoFGFR levels (Figure S5D). This confirmed increased ERK 
oscillations for PP2A and PLCG1 KD and decreased ERK oscillations for RSK2, CRAF 
and ERK2 KD. To validate these findings in the context of an endogenous RTK, we 
evaluated ERK2, CRAF and RSK2  KD in cells stimulated with 1 ng/ml EGF, which 
leads to prominent ERK oscillations (Figure S2C). ERK2 KD decreased ERK activation 
rate and amplitude, while CRAF and RSK2 KD decreased ERK oscillations (Figure 
S5E), which was confirmed with hierarchical clustering (Figure S5F,G). The ERK2 and 
CRAF isoforms might therefore be specifically involved in the negative feedback in 
which ERK phosphorylates and negatively regulates  RAF activity (Fritsche-Guenther 
et al., 2011) . RSK2 encodes the p90 ribosomal S6 kinase 2, an ERK substrate that 
mediates negative feedback at the level of the GEF SOS (Douville and Downward, 
1997; Lake et al., 2016; Saha et al., 2012). This suggests that two negative feedbacks, 
one from ERK to RAF, and the o ther from ERK to SOS via RSK2, simultaneously 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
10 
operate within the MAPK network in order to generate ERK oscillations (Figure 4A). 
As negative feedback enables network robustness against noise in signaling node 
expression levels (Fritsche-Guenther et al., 2011) , two negative feedbacks acting at 
different levels in the MAPK network might be advantageous to warrant this 
robustness. 
 
 
SPRY1
FGFR1
FRS2
GRB2
Shc1
SPRY4SPRY2
PTPN6
GAB1
PTPN11
SPRY3
DUSP26DUSP22
DUSP10
DUSP16
DUSP4
DUSP8
DUSP1 DUSP3
DUSP6
DUSP2
DUSP9
SOS2
SOS1
RAPGEF3
NF1
RAPGEF1 RASA1
RASGRP 1
PP2A
MEK2 CNKSR1
ERK1
KSR1
NCK1
SRCNCK2
PTK2
CRKL
SHIP
PLCG1
RRASNRAS
RKIP
YWHAZHRAS
RAP1A
RAP1B KRAS
YWHAG
CRAF
RSK2
PEA15
ERK2
MEK1
ARAF BRAF
DUSP14
A B
GAPDH
1.00
0.25
0.50
0.75
ERK2 ERK1+2
CTRL ERK1
20 400 10 30
1.00
0.25
0.50
0.75
20 400 10 30
ERK2 ERK1+2CTRL ERK1
ERK1
ERK2
Time [min]
ERK activity
C
Receptor 
proximal layer
MembraneMAPK 
cascade
Downstream
D High optoFGFR expression
CTRL
ERK1+2
FRS2
GRB2
GAB1
Shc1
PTK2
CRKL
SPRY1
SPRY2
SPRY3
SPRY4
PTPN6
PTPN11
SHIP
PLCG1
SRC
NCK1
NCK2
SOS1
SOS2
RAPGEF1
RAPGEF3
RASGRP1
RASA1
NF1
RAP1A
RAP1B
HRAS
KRAS
NRAS
RRAS
RKIP
YWHAZ
YWHAG
CNKSR1
KSR1
PP2A
ARAF
BRAF
CRAF
MEK1
MEK2
ERK1
ERK2
RSK2
PEA15
DUSP1
DUSP2
DUSP3
DUSP4
DUSP6
DUSP8
DUSP9
DUSP10
DUSP14
DUSP16
DUSP22
DUSP26
0.5
1.0ERK activity at maxPeak
1.5
maxPeak
Time
ERK activity
CTRL
CTRL
ERK activity
GRB2 RAPGEF1FRS2 CRAFDUSP6
PLCG1PP2A ERK2ERK1+2 RSK2
ERK activity
Time [min]
Low 
optoFGFR
random 
trajectories
High
optoFGFR
random 
trajectories
1.00
0.25
0.50
0.75
20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30
1.00
0.25
0.50
0.75
1.00
0.25
0.50
0.75
1.00
0.25
0.50
0.75
20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30
1.00
0.25
0.50
0.75
1.00
0.25
0.50
0.75
E
CODEX
prototype 
trajectories
****
****
****
*
**
**
****
****
****
*
****
***
***
*
****
****
**
****
***
****
****
*
****
****
****
***
*
*
***
*
****
****
****
****
****
*
Receptor
GEFs, GAPs, GTPases
Kinases
Phosphatases
Adaptors, scaffolds, antagonists
44 kDa
42 kDa
Low 
optoFGFR
random 
trajectories
High
optoFGFR
random 
trajectories
CODEX
prototype 
trajectories
Fig.3
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
11 
Figure 3: Large -scale perturbation of the MAPK network r eveals robustness against 
downregulation of its signaling nodes. (A) RNAi perturbation targets. Signaling nodes were spatially 
grouped based on the hierarchy of interactions within the MAPK network and color -coded for their 
function. (B) ERK responses to sustained optoFGFR inputs (D = 18 mJ/cm 2) in cells transfected with 
10 nM siRNA against ERK1, ERK2 or a 5 nM combination of each ( ERK1+2). A non-targeting siRNA 
(CTRL) was used as control (N = 15 cells from low and high optoFGFR levels). (C) Western blot analysis 
of cells transfected with 10 nM siRNA against ERK1, ERK2 or a 5 nM combination of each (ERK1+2). 
(D) Quantification of the maxPeak of single-cell ERK responses under sustained high optoFGFR inputs 
(D = 18 mJ/cm2) for each RNAi perturbation (N = 60 c ells per treatment, from 3 technical replicates). 
Statistical analysis was done using a Wilcoxon test comparing each perturbation against the non -
targeting siRNA (CTRL) (Nmin = 120 cells per condition, *< 0.05, **<0.005, ***<0.0005, ****<0.00005, 
FDR p-value correction method). (E) Single-cell ERK trajectories in response to sustained optoFGFR 
inputs (D = 18 mJ/cm2) for the RNAi perturbations classified with the highest accuracy by CODEX. Top 
line shows single-cell ERK trajectories for which CODEX had the h ighest classification confidence in 
the validation set (N = 10). Bottom lines show single-cell ERK trajectories for low and high optoFGFR 
cells (N = 30 for each, randomly selected out of at least 212 cells per perturbation from 3 technical 
replicates). For better visualization, the CTRL condition is shown twice.  
The RAS/ERK subnetwork is less robust against node perturbation than the 
whole optoFGFR-triggered MAPK network 
To explore the significance of the two feedbacks in the MAPK network, we used 
optoSOS, an optogenetic actuator that activates RAS (Johnson et al., 2017). OptoSOS 
directly induces the RAS/RAF/MEK/ERK subnetwork (referred to as the RAS/ERK 
subnetwork), bypassing any feedback regulation upstream of RAS, such as the 
ERK/RSK2/SOS negative feedback (Douville and Downward, 1997; Lake et al., 2016; 
Saha et al., 2012)  (Figure 4A). OptoSOS consists of a membrane anchored light -
activatable iLID domain, and an mC itrine-tagged SspB domain fused to SOS’s 
catalytic GEF domain. It was stably integrated into cells expressing ERK -KTR and 
H2B. Because iLID displays faster dissociation rates than CRY2 (t1/2= 30 seconds for 
iLID versus ~ 5 minutes for CRY2 (Benedetti et al., 2018; Duan et al., 2017)), optoSOS 
required repeated light pulses for prolonged membrane recruitment to produce a 
robust ERK response. A single light pulse resulted in a low amplitude ERK transient, 
even at high light dose (Figure 4B,  “1x”). Five consecutive 100 ms light pulses at 6 
W/cm2 light pulses (D = 0.6 J/cm2) applied at 20-second intervals, provided the minimal 
light input to induce a saturated ERK amplitude (Figure S6A). Application of this light 
input at 2-minute intervals evoked sustained ERK dynamics with small fluctuations at 
the same frequency than the light input pattern, reflecting the fast optoSOS reversion 
to the dark state (Figure 4C). OptoSOS did not induce ERK oscillations (Figure S6B), 
even in optoSOS low cells or for lower light doses (Figure 4D). However, ERK 
amplitudes correlated with optoSOS expression level - low versus high optoSOS levels 
leading to low versus high ERK amplitudes. Using the minimal light input to trigger 
saturating ERK amplitude, both optoSOS and optoFGFR led to steep ERK activation 
and fast adaptation when light stimulation ceased (compare Figures 2C and 4C), as 
well as similar ERK amplitudes in cel ls with high optogenetic actuator levels (Figure 
4E). However, optoSOS -evoked ERK dynamics displayed desensitization on 
timescales of tens of minutes and did not exhibit the ERK dip.  
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
12 
After establishing the light regime that induces ERK responses comparabl e to those 
induced by optoFGFR, we performed an siRNA screen targeting only the network 
nodes downstream of optoSOS (Figure S6C,D). As optoSOS evoked simpler ERK 
dynamics than optoFGFR, we evaluated the effect of the perturbation by extracting 
ERK amplitudes in optoSOS -high cells (Figure 5A, compared to 3D). We compared 
the penetrance of the perturbations in both optogenetic systems, by standardizing the 
ERK amplitudes with the control treatment (Figure 5B). Most perturbations affected 
ERK amplitude in a si milar way. However, several perturbations led to a more 
penetrant phenotype in the optoSOS than in the optoFGFR system. This was true but 
not restricted to perturbation of RAS and RAP isoforms ( RASA1, RAP1A, RAP1B, 
HRAS, NRAS), YWHAZ, PP2A, MEK1, MEK2, ERK1 and ERK2, and a number of 
DUSPs (DUSP10, DUSP14, DUSP16, DUSP22, DUSP26). In addition, CRAF KD led 
to an almost complete loss of ERK activity in the optoSOS compared to the optoFGFR 
system. Further evaluation of ERK dynamics phenotypes illustrated these findings - 
ERK1, ERK2 and CRAF KD led to lower ERK activity, while PP2A and DUSP22 KD 
led to a prominent increase in ERK amplitude (compare Figure 5C and 3E). Our results 
therefore suggest that the RAS/ERK subnetwork is less resilient against node 
perturbations than the full MAPK network. 
 
  
Figure 4: OptoSOS sustained inputs trigger ERK dynamics without oscillatory behavior. (A)  
Schematic representation of ERK signaling induced by optoSOS versus optoFGFR inputs. (B) ERK 
dose responses under transient optoSOS inputs consisting of different numbers of repeated 470 nm 
pulses (1x, 2x, 3x, 4x and 5x pulses applied at 20 -second intervals, D = 0.6 J/cm2). Repeated pulses 
are depicted as a single stimulation bar (blue).  (C) Cells expressing optoSOS were stimulated with 5 
repeated 470 nm light pulses delivered every 20, 10, 5 and 2 minutes respectively (D = 0.6 J/cm2). (D) 
A B
D E
maxPeak
Time
ERK activity
0.5
1.0
optoFGFR optoSOS
1.5
NA ****
*
NA
low highExpression
ERK activity at maxPeak
0 J/cm2 0.05 J/cm2 0.6 J/cm20.01 J/cm2
ERK activity
1.00
0.25
0.50
0.75
20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30
1.00
0.25
0.50
0.75
Time [min]
Light dose
0 x
0.25
0.50
0.75
1.00
Time [min]
ERK activity
0 10 20 30 40
C 2 min interval10 min interval20 min interval
25 50 75525 50 755
ERK activity
0.25
0.50
0.75
1.00
25 50 755 25 50 755
5 min interval
Time [min]
0 10 20 30 40 0 10 20 30 40 0 10 20 30 40
Number of pulses [0.6 J/cm2]
1 x 3 x 5 x
SOScat
RSK2
FGFR
cyto
FGFR
cyto
SOS
MEK
GRB2
FRS2
RAF
RAS
ERK
P
P
P
P
P
Low 
optoSOS
High
optoSOS
Fig.4
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
13 
ERK responses to increasing light doses of sustained optoSOS inputs consisting of 2-minutes interval 
inputs, each input made of 5 repeated light pulses. Cells were divided in low and high optoSOS 
expression levels based on the log10 intensity of the optoSOS -mCitrine. (E) Quantification of the 
maxPeak of single-cell ERK responses under sustained optoFGFR (Figu re 2F, D = 18 mJ/cm 2) and 
optoSOS (Figure 4D, D = 0.6 J/cm2) inputs for low or high expression of each optogenetic system (N = 
40 cells per condition). Statistical analysis was done using a Wilcoxon test, comparing each perturbation 
against the CTRL (Nmin = 48 cells per condition, *<0.05, **<0.005, ***<0.0005, ****<0.00005, FDR p -
value correction method).  
 
Figure 5: The RAS/ERK subnetwork is less robust against node perturbation than the whole 
optoFGFR-triggered MAPK network. (A) Quantification of the maxPeak for single-cell ERK responses 
induced by sustained high optoSOS inputs (D = 0.6 J/cm 2) for RNAi perturbations targeting nodes of 
the RAS and ERK subnetwork (N = 20 cells per treatment). Statistical analysis was done using a 
Wilcoxon test, comparing each perturbation against the CTRL (Nmin = 20 cells per perturbation, *<0.05, 
**<0.005, ***<0.0005, ****<0.00005, FDR p -value correction method). (B) z-Score comparing ERK 
maxPeak under RNAi perturbations of the RAS/ERK subnetwork to the non-targeting siRNA (CTRL) for 
high optoSOS and high optoFGFR (Figure 3D) sustained inputs. (C) Single-cell ERK trajectories for low 
and high optoSOS cells (N = 15 each) for selected RNAi perturbations.  
The RSK2 negative feedback confers robustness to the MAPK network against 
MEK inhibition 
To further compare the robustness of the MAPK network to the RAS/ERK subnetwork, 
we performed dose response experiments with the MEK inhibitor U0126 in response 
to sustained optoFGFR and optoSOS inputs (Figure 6A). As some perturbations led 
to complete loss of ERK activity, we quantified ERK amplitudes at a fixed time point 
(tfixed) that corresponds to the maximum amplitude in the c ontrol (Figure 6B). We 
observed that ERK amplitudes decreased in optoFGFR cells with increasing U0126 
doses, but that the population inhibition remained largely heterogeneous for 
B
High 
optoSOS
High 
optoFGFR
CTRL
ERK1+2
RASA1
NF1
RAP1A
RAP1B
HRAS
KRAS
NRAS
RRAS
RKIP
YWHAZ
YWHAG
CNKSR1
KSR1
PP2A
ARAF
BRAF
CRAF
MEK1
MEK2
ERK1
ERK2
PEA15
DUSP1
DUSP2
DUSP3
DUSP4
DUSP6
DUSP8
DUSP9
DUSP10
DUSP14
DUSP16
DUSP22
DUSP26
A
0.5
1.0
CTRL
ERK1+2
RASA1
NF1
RAP1A
RAP1B
HRAS
KRAS
NRAS
RRAS
RKIP
YWHAZ
YWHAG
CNKSR1
KSR1
PP2A
ARAF
BRAF
CRAF
MEK1
MEK2
ERK1
ERK2
PEA15
DUSP1
DUSP2
DUSP3
DUSP4
DUSP6
DUSP8
DUSP9
DUSP10
DUSP14
DUSP16
DUSP22
DUSP26
High optoSOS expression
ERK activity at maxPeak
1.5
****
****
****
****
***
***
****
****
**
****
****
****
***
****
***
**
**
*
**
*
*
*
*
*
*
*
*
*
−2
−1
0
zScore 
maxPeak
CTRL ERK1PP2A ERK2ERK1+2 CRAF
ERK activity
Time [min]
1.00
0.25
0.50
0.75
20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30
1.00
0.25
0.50
0.75 Low 
optoSOS
High
optoSOS
20 400 10 30
DUSP22C
maxPeak
Time
ERK activity
Fig.5
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
14 
concentrations below 20 µM (Figure 6B,C). In contrast, optoSOS -evoked ERK 
dynamics were more sensitive to increasing U1026 and the ERK amplitude 
heterogeneity decreased at lower doses, leading to lower IC 50 values for optoSOS 
than for optoFGFR -evoked ERK dynamics (Figure 6D). We hypothesized that the 
sensitivity of the optoSOS-triggered RAS/ERK subnetwork arises from the absence of 
the RSK2-mediated feedback that operates upstream of SOS. We therefore evaluated 
optoFGFR-triggered ERK dynamics in response to MEK perturbation in RSK2 KD cells 
(Figure 6E-H). RSK2 KD decreased ERK heterogeneity at lower U0126 concentrations 
(Figure 6E,G), and reduced the IC 50 of U0126-mediated ERK inhibition (Figure 6H). 
Similar results were obtained with SL0101, a RSK inhibitor (Smith et al., 2005) (Figure 
S7A-D). Thus, loss of the RSK2 -mediated feedback, either by direct activation of the 
RAS-ERK subnetwork, or by RSK2 perturbation, decreases the network robustness 
to MEK perturbation. 
 
 
Figure 6: The RSK2 negative feedback confers robustness to the MAPK netw ork against MEK 
inhibition. (A) Single-cell ERK responses to sustained high optoFGFR (D = 18 mJ/cm 2) or optoSOS 
(D = 0.6 J/cm2) inputs under increasing concentrations of U0126 (N = 40 cells per condition, randomly 
selected out of at least 200 cells from 3 technical replicates). (B) ERK responses were extracted at a 
fixed time point from single -cell trajectories shown in (A)  (tfixed optoFGFR = 10 minutes, t fixed optoSOS  = 7 
minutes, N = 200 cells per condition). (C) Normalized standard deviation of ERK amplitudes shown in 
(A) (Nmin = 200 cells per perturbation). (D) A Hill function was fit to the mean ERK activity as shown in 
(A). Shaded area indicates the 95% CI and dashed lines the IC50. (E) Single-cell ERK responses to 
CB High optoFGFR High optoSOS D
F
U0126 [μM]
ERK activity at tfixedERK activity at tfixed
G H
CTRL KD RSK2 KD
U0126 [μM]
High optoFGFR
0.5
1.0
0 5 2010 502
High 
optoFGFR 
High 
optoSOS 
U0126 [μM]
0 1
Normalized SD
0 5 2010 502
High 
optoFGFR
+ CTRL KD
High 
optoFGFR
+ RSK2 KD
U0126 [μM]
0 5 2010 502
0 1
Normalized SD
U0126 [μM]
IC50= 4.9 μM
IC50= 1.2 μM
0.4
0.6
0.8
1.0
0 1 2 5 5010 20
High optoFGFR High optoSOS
0.5
1.0
0 5 2010 502
CTRL KD RSK2 KD
High optoFGFR
IC50= 7.4 μM
IC50= 3.7 μM
_
_
_
_
_
U0126 [μM]
0.4
0.6
0.8
1.0
0 1 2 5 5010 20
A
High optoFGFR
High optoSOS
High optoFGFR 
+ CTRL KD
High optoFGFR 
+ RSK2 KD
ERK activity
1.0
0.5
20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30
1.0
0.5
2 μM U0126 5 μM U0126 10 μM U0126 20 μM U01260 μM U0126
Time [min]
20 400 10 30
50 μM U0126
ERK activity1.0
0.5
20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30 20 400 10 30
1.0
0.5
Time [min]
20 400 10 30
E
Fig.6
ERK activity at tfixedERK activity at tfixed
2 μM U0126 5 μM U0126 10 μM U0126 20 μM U01260 μM U0126 50 μM U0126
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
15 
sustained high optoFGFR inputs (D = 1 8 mJ/cm 2) in CTRL or RSK2 KD cells under increasing 
concentrations of U0126 (N = 40 cells per condition (apart from RSK2 KD + 0 μM U0126 (32 cells), from 
2 technical replicates for RSK2 KD and 1 replicate for CTRL KD). (F) ERK responses were extracted at 
tfixed = 10 minutes from single-cell trajectories shown in (E) (N = 100 cells per condition (except for RSK2 
KD + 0 μM U0126)). (G) Normalized standard deviation of ERK amplitudes shown in (E) (N min = 100 
cells per perturbation (apart from RSK2 KD + 0 μM U0126)). (H) A Hill function was fitted to the mean 
ERK activity as shown in (E). Shaded area indicates the 95% CI and dashed lines the IC50. 
Targeting the RSK2 -mediated feedback  in combination with MEK inhibition 
potently inhibits population -level ERK dynamics in response to EGFR and 
oncogenic ErbB2 inputs 
Our results highlighted the role of the RSK2-mediated feedback in the MAPK network 
robustness against node perturbations in NIH3T3 cells. To test if it also contributes to 
network robustness in a disease -relevant system, we evaluated its function in non -
tumorigenic wild -type (WT) MCF10A breast epithelial cells, as well as in ErbB2 -
overexpressing MCF10A cells, that recapitulate ErbB2 amplification observed in 20% 
of all breast cancers (Arteaga and Engelman, 2014; Yarden and Pines, 2012) . We 
chose this specific model system because ErbB2 amplification leads to a constitutive 
RTK input on the MAPK network, with an intact downstream feedback structure, in 
contrast to mutated RAS or RAF signaling. MCF10A WT cells display asynchronous 
low frequency ERK pulses in the absence of EGF, and high frequency ERK pulses in 
the presence of EGF (Figure S7E) (Albeck et al., 2013). On the other hand, MCF10A 
ErbB2 overexpressing cells displayed high ERK pulse frequencies in t he absence of 
EGF. Previous work has highlighted the role of negative feedbacks in ERK pulse 
formation (Kochańczyk et al., 2017), suggesting that EGFR and ErbB2 trigger a MAPK 
network with similar feedback circuitry as in our optoFGFR fibroblast system. Thus, 
we reasoned that destabilizing network robustness with RSK2 perturbation might 
potential MEK-mediated ERK inhibition (Figure 7A). We first identified conditions that 
lead to partial ERK inhibition by performing a U0126 dose response and evaluating 
ERK amplitudes directly after acute EGF stimulation (Figure S7F). We found that 3 µM 
U0126 decreased the median ERK amplitudes, but still led to considerable ERK 
amplitude heterog eneity. In population -averaged measurements of EGF -stimulated 
MCF10A WT cells, 3 µM U0126 or 50 µM SL0101, led to a partial decrease in ERK 
activity, while their combination led to potent ERK inhibition (Figure 7B). A similar effect 
was observed in ErbB2 -overexpressing cells (Figure 7C). However, averaging 
asynchronous ERK dynamics only provides limited insights into single -cell ERK 
dynamics. We therefore used CODEX to identify single -cell ERK dynamics patterns 
under U0126, SL0101 and their combination. 
For EGF-stimulated MCF10A WT cells, projection of the CNN features of each ERK 
trajectory in a tSNE space identified 5 characteristic ERK dynamics, each 
corresponding to one treatment (Figure 7D-F). Cluster 1 (no EGF stimulation) revealed 
low frequency ERK ac tivity pulses. Cluster 2 (EGF stimulation) revealed a compact 
distribution of cells with an initial EGF-triggered ERK peak followed by high frequency 
ERK pulses. Cluster 3 (EGF, SL0101 treatment) revealed a heterogeneous mix of 
trajectories, some of which display wider ERK pulses, while others showed lower ERK 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
16 
amplitudes. Cluster 4 (EGF, U0126 treatment) revealed a compact distribution of cells 
with low amplitude ERK pulses. Cluster 5 (EGF, drug combination) revealed a 
compact cluster distribution of cells with low baseline ERK activity. 
For ErbB2 overexpressing MCF10A cells, the t -SNE projection suggested a much 
higher heterogeneity than for EGF-treated MCF10A WT cells (Figure 7G-I). Cluster 1 
(untreated cells) revealed robust ERK pulses. SL0101-mediated RSK inhibition led to 
a highly heterogeneous landscape of wide, high amplitude ERK pulses (cluster 2), 
relatively flat ERK trajectories of intermediate amplitude (cluster 3) and absence of 
ERK pulses with low baseline activity (cluster 5). U0126 -mediated MEK inhibition led 
to a compact distribution of cells with low amplitude ERK pulses (cluster 4), as well as 
some cluster 3 and 5 trajectories. Combination of both drugs shifted most of the 
population to cluster 5 (absence of ERK pulses and low baseline activi ty). Thus, 
targeting MAPK network robustness through RSK inhibition increases ERK 
heterogeneity, and sensitizes ERK activity to MEK inhibition. 
Finally, we evaluated cell cycle dynamics in response to single and combined 
RSK/MEK inhibition using the G1/S/m itosis geminin-mCherry sensor. MCF10A WT 
cells treated with 50 µM of SL0101, 1 µM of U0126 or their combination, were 
stimulated with 10 ng/ml EGF and the biosensor activity was followed for 40 hours. 
Clustering of geminin trajectories from all experiments  revealed cell populations with 
absence of geminin expression (cluster 1), or transient weak geminin expression 
(cluster 2) assumed not to enter the cell cycle, as well as robust, early (cluster 3), 
delayed (cluster 4) or late (cluster 5) geminin expression, that were assumed to enter 
the cell cycle (Figure 7J,S7G). We then evaluated the proportion of the geminin profiles 
for each treatment (Figure 7K). Starved cells mostly showed no geminin expression 
(cluster 1). EGF stimulation increased cells displaying high geminin expression (25% 
of cells belonging to clusters 3, 4, 5). RSK inhibition decreased the proportion of cells 
with high geminin expression and increased the proportion of trajectories in clusters 1 
and 2. This most likely occurs because RSK direc tly regulates several cell -cycle 
checkpoints (Casalvieri et al., 2017). Weak MEK inhibition using 1 µM U0126 led to a 
mild reduction of cell cycle entry, consistent with moderate effects on ERK dynamics. 
However, consistently with potent ERK activity inhibition by the combined treatments, 
cell cycle entry was strongly suppressed. Thus, weakening MAPK robustness through 
perturbation of the RSK2 negative feedback sensitizes cells  to MEK inhibition to 
potently inhibit ERK activity and shut down cell cycle entry. 
 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
17 
 
Figure 7: Targeting the RSK2-mediated feedback in combination with MEK inhibition potently 
inhibits ERK dynami cs in response to EGFR and oncogenic ErbB2 inputs. (A) Schematic 
representation of the MAPK network in response to EGFR inputs in MCF10A WT cells or oncogenic 
ErbB2 inputs. Cells were treated with single or combined perturbations of RSK (SL0101) and MEK 
(U0126). (B-C) Average ERK responses evoked in MCF10A WT cells by EGF stimulation (10 ng/ml 
EGF added at t = 30 minutes) (B) or ErbB2 overexpressing MCF10A cells (C) under no inhibitor, the 
RSK (SL0101) and MEK (U0126) inhibitors alone or combined. Shaded areas indicate the 95% CI. (D-
E) tSNE projection of CODEX’s CNN features from ERK activity of MCF10A WT cells described in (B). 
(F) Representative single-cell trajectories for the different clusters displayed in (D -E). (G-H) tSNE 
projection of CODEX’s CNN features from ERK activity of ErbB2 overexpressing cells described in (C). 
(I) Representative single-cell trajectories for the different clusters displayed in (G -H). (J) Hierarchical 
clustering (Euclidean distance and Ward D2 linkage) of geminin trajectories in MCF10A WT cells treated 
with the RSK (SL0101) and MEK (U0126) inhibitors alone or combined (NnoEGF = 510 cells, NEGF = 260, 
NSL0101 = 1190, N U0126 = 540, N SL0101+U0126 = 1740). The number of clusters was arbitrarily defined to 
A EGF
SL0101
U0126
P
P
P P P P
EGFR
ErbB2
3 μM U0126
50 μM SL0101
3 μM U0126 
+ 50 μM SL0101
no EGF
no inhibitor
MCF10A - ErbB2 overexpression
Time [hours]
CB
Average ERK activity
Time [hours]
MCF10A - EGF stimulation
0 5 10
0.6
1.4
15
1.0
10 ng/ml EGF
xTSNE
yTSNE
MCF10A - EGF stimulation
1
2
3
4
5
Cluster 1 Cluster 2 Cluster 3 Cluster 4 Cluster 5
1
2
3
4
5
D
F
no EGF 50 μM SL0101 3 μM U0126 3 μM U0126 
+ 50 μM SL0101no inhibitor
E
1
23
4
5
1
23
5
3
4
5
3
4
5
MCF10A - ErbB2 overexpressionG H
xTSNE
yTSNE
50 μM SL0101 3 μM U0126 3 μM U0126 
+ 50 μM SL0101no inhibitor
Cluster 1 Cluster 2 Cluster 3 Cluster 4 Cluster 5
Time [hours]
I
0 5 10 15
0.5
1.0
1.5ERK activity
0 5 10 15 0 5 10 15 0 5 10 15 0 5 10 15
2.0
J
Time [hours]
K
Geminin trajectories
0
6
Geminin 
intensity 
[x 10-2]
Time [hour]
1
2
4Geminin intensity [x 10-2]
3
8 24 3216 40
 1 μM 
U0126
+ 50 μM 
SL0101
no drug 50 μM 
SL0101
no drug 1 μM
U0126
% of cells per cluster
75
100
0
87.5
Clusters
1 2 3 4 5
+ 10 ng/ml EGFno EGF
0 5 10
0.6
1.4
15
1.0Average ERK activity
0 5 10 15
0.5
1.0
1.5ERK activity
0 5 10 15 0 5 10 15 0 5 10 15 0 5 10 15
2.0
Time [hours]
RSK2
MEK
GRB2
RAF
ERK
P
P
P
SOS
RAS
Fig.7
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
18 
separate the different geminin dynamics. Average geminin responses per cluster are displayed on the 
right. (K) Percentage of geminin trajectories per cluster displayed in (J). The y -axis was truncated for 
better visualization. 
  
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
19 
Discussion 
 
How the MAPK network is wired to translate different environmental inputs into distinct 
ERK dynamics, and thus fates, remains poorly understood. This stems fro m limited 
experimental throughput to measure single-cell ERK dynamics in response to defined 
inputs. Our optogenetic circuits overcome this limitation by allowing for automatized 
dynamic inputs, ERK dynamics measurement in large numbers of cells under multiple 
perturbations, and for activation of the network at different levels to evaluate the 
specific properties of subnetworks. Even if optoFGFR does not capture all the 
properties of endogenous RTKs, our combined modeling and experimental approach 
showed that it provides valid insights about MAPK network topology downstream of 
endogenous RTKs (Text S2, Figure S3). Understanding this network topology 
provides new insight into how to drug network robustness for potent ERK inhibition in 
an ErbB2-driven oncogenic system. 
Negative feedbacks provide robustness to the MAPK network 
What comes strikingly out of our siRNA screens, is that very few perturbations led to 
penetrant phenotypes (Figure 3E). This goes against the intuition that perturbing core 
nodes of the MAPK network should have a great impact on the downstream ERK 
activity. This implies that the MAPK network is robust against perturbations of many 
signaling nodes, warranting high fidelity signal transduction in the presence of 
heterogeneous node expression levels. This robustness might emerge from functional 
redundancy of different node isoforms, but also from negative feedbacks, the most 
notable of which is the classic ERK to RAF negative feedback (Fritsche-Guenther et 
al., 2011; Sturm et al., 2010).  
A striking result of our screen was that the ERK -RSK2-SOS negative feedback 
operates simultaneously with the aforementioned ERK -RAF feedback in response to 
the RTK input. The ERK substrate RSK2 has been proposed to mediate negative 
feedback by disrupting the GRB2-SOS complex (Douville and Downward, 1997; Saha 
et al., 2012). Our data also suggest that the CRAF and ERK2 isoforms are specifically 
mediating the ERK-RAF negative feedback. Additional feedbacks have been reported 
within the MAPK network  (Kochańczyk et al., 2017; Lake et al., 2016; Langlois et al., 
1995), and even if they have not been highlighted in our screen, they might also shape 
ERK dynamics. We then hypothesized tha t these negative feedbacks might warrant 
robustness against noise in node expression by simultaneously operating at multiple 
levels in the MAPK network. Bypassing the ERK -RSK2-SOS feedback by optoSOS -
mediated RAS/ERK subnetwork activation, or by RSK2 perturbation, indicated that the 
latter is crucial for network robustness and high -fidelity signal transduction. This was 
apparent from the findings that: 1. ERK dynamics are more sensitive to RNAi 
perturbations in response to an optoSOS versus an optoFGFR inpu t (Figure 5), and 
2. absence of the ERK -RSK2-SOS negative feedback sensitizes the network to 
additional MEK perturbation (Figure 6). The relative contributions of both feedbacks 
are difficult to evaluate since in the case of the ERK and RAF, the feedback d irectly 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
20 
involves both nodes. To mechanistically explore the idea that a MAPK network with 
multiple negative feedbacks provides robustness against noise in the expression level 
of its components, we tried to model MAPK network topologies with multiple 
feedbacks. We however were unable to unambiguously identify specific models and 
parameters while fitting ERK dynamics time -series. The identification of predictive 
models that take into account the signaling complexity that we have identified will 
require additional information about the different nodes and their dynamics to further 
constrain the model topology and parameter space. 
Drugging RSK2-mediated network robustness potently shuts down EGFR and 
oncogenic ErbB2 ERK signaling 
Our genetic circuits, together  with system -wide perturbations, indicate that the 
RTK/MAPK network is robust against node perturbation, which emerges at least in 
part because of the ERK -RSK2-SOS feedback.  We found that this feedback also 
operates downstream of EGFR and oncogenic ErbB2 s ignaling in MCF10A cells 
(Figure 7). In both EGF-treated or ErbB2 overexpressing MCF10A cells, RSK inhibition 
led to highly heterogeneous ERK dynamics, which resulted in the inability of the MAPK 
network to cope with network node expression noise. Note tha t a subset of RSK -
inhibited cells displayed wider ERK pulses, possibly also indicative of decreased 
negative feedback (Figure 7F,I). Note that inhibition of RSK2 alone might lead to a 
highly heterogeneous landscape of ERK dynamics that possibly could promo te 
proliferation/survival in a cell population subset (Gagliardi et al., 2021) . A low MEK 
inhibitor dose mildly affected population -averaged ERK activity. However, combined 
RSK2/MEK inhibition shifted a large cell population towards robust ERK inhibition in 
both MCF10A systems. Thus, RSK2 inhibition can be used to drug network 
robustness, sensitizing the MAPK network to additional perturbations such as MEK 
inhibition. The ability of this drug combination to efficiently switch off ERK in a large 
number of cells might mitigate the risk of emergence of drug -resistant cells. We 
observed that combined RSK2/MEK inhibition also increased cell cycle entry inhibition. 
Altogether, these results strongly suggest that this does not result from additive effects 
of both drugs, but through weakening MAPK network robustness by RSK2 inhibition, 
which then potentiates MEK inhibition. Detailed understanding of MAPK network 
topology can therefore provide unintuitive insights into efficient pharmacological shut 
down of ERK signaling. 
Additional new insights into regulation of ERK dynamics 
Our screens provided a number of additional insights about MAPK network regulation 
(Figure 3D,E). PLCG1 KD led t o steeper ERK activation and increased oscillatory 
behavior. Phospholipase Cɣ1 activates calcium signaling, which has itself been shown 
to regulate RAS/MAPK signaling in a calcium spike frequency -dependent manner 
(Cullen and Lockyer, 2002; Kupzig et al., 2005). Further investigation will be required 
to understand the significance of this crosstalk. KD of RAPGEF1, which encodes the 
Rap1-specific GEF C3G, also  led to increased oscillatory ERK behavior. C3G/Rap1 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
21 
signaling has previously been shown to collaborate with RAS to regulate NGF -
dependent sustained ERK dynamics in PC -12 cells (York et al., 1998) . Thus, C3G 
might also fine tune ERK dynamics through a mechanism that remains to be 
determined. GRB2 KD led to one of the strongest phenotypes with respect to ERK 
amplitude. GRB2 KD also led to ERK dynamics that fluctuated with distin ct kinetics 
within different cells of the population, and highly heterogeneous ERK amplitudes. 
GRB2 acts as the RTK-proximal adaptor to activate the RAS-specific SOS (Belov and 
Mohammadi, 2012; Chardin et al., 1993). As it is operating above SOS, GRB2 lacks a 
negative feedback that can buffer against heterogeneous expression levels. Low 
GRB2 levels might therefore be especially prone to inefficient signal transmission from 
the RTK to the MAPK network. GRB2 might thus be another vulnerable node for 
drugging network robustness. A similar, although less penetrant phenotype, was 
observed for KD of FRS2, another adaptor protein directly operating downstream of 
FGFR (Gotoh, 2008). 
With regard to phosphatases, we found that PP2A KD led to a robust increased ERK 
amplitude in response to both optoFGFR and optoSOS inputs (Figure 3D,5A,B). This 
mostly occurs because protein phosphatase 2A is a major phosphatase that can act 
at multiple levels by dephosphorylating Shc1, MEK1, MEK2, ERK1 and ERK2 (Junttila 
et al., 2008). In optoFGFR -low PP2A KD cells, oscillatory ERK dynamics displayed 
increased amplitude (Figure 3E), suggesting that negative feedback can buffer for loss 
of phosphatase regulation to some extent. Perturbation of many of the DUSPs known 
to be expressed in our cell system also led to increased ERK amplitude. These DUSPs 
consist of classic MAPK phosphatases that localize to the cytosol (DUSP6, DUSP16), 
the nucleus (DUSP1, DUSP2, DUSP4), or both compartments (DUSP8, DUSP9, 
DUSP10), as well as of atypical DUSPs (DUSP3, DUSP14, DUSP22, DUSP26) that 
also can have effects on ERK (Patterson et al., 2009) . DUSP6 KD led to increased 
baseline ERK activity levels (Figure S5C). Consistently, DUSP6 has previously been 
proposed to pre -emptively dephosphorylate MAPKs to maintain low ERK activity 
baseline levels at resting state (Huang and Tan, 2012) . Our results indicate that 
perturbation of one DUSP cannot be compensated by the others, suggesting that 
individual DUSPs regulate specific substrates within the MAPK network. DUSP 
perturbations affected ERK amplitude directly upon application of the light input. This 
implies that, at least in our system, DUSP activity does not necessarily require ERK -
dependent transcription of these phosphatases, as previously observed for DUSP2 
that is an ERK-dependent immediate-early gene (Wei et al., 2013). KD of the different 
DUSPs did not markedly affect oscillatory ERK behavior in optoFGFR -low cells, 
suggesting that DUSPs are not involved in the MAPK feedback circuitry that operates 
on timescales of minutes. Finally,  DUSP4 KD led to lower ERK amplitude (Figure 
3D,5A,B). This might occur because of specificity for other kinases such as p38 and 
JNK that might feed back to the MAPK pathway (Patterson et al., 2009).  
To sum up, our scalable experimental pipeline for measuring ERK dynamics provides 
new insights about MAPK network topology, such as novel l ayers of regulations that 
will need to be explored in the future, and the characterization of a novel druggable 
feedback important for MAPK network robustness. This provides new opportunities for 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
22 
efficient pharmacological targeting of oncogenic MAPK signaling. With the increasing 
amount of optogenetic actuators and biosensors available, similar genetic circuits can 
be designed in the future to study the dynamics of other signaling pathways at scale. 
 
 
 
  
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
23 
Material and methods 
  
Cell culture and reagents 
NIH3T3 cells were cultured in DMEM high glucose medium with 5% fetal bovine 
serum, 4 mM L-glutamine, 200 U/ml penicillin and 200𝜇g/ml streptomycin at 37°C with 
5% CO 2. All imaging experiments with NIH3T3 were done in starving medium 
consisting of DMEM high gl ucose supplemented with 0.5% BSA (Sigma), 200 U/ml 
penicillin, 200𝜇g/ml streptomycin and 4 mM L-Glutamine. MCF10A human mammary 
cells were cultured in DMEM:F12 supplemented with 5% horse serum, 20 ng/ml 
recombinant human EGF (Peprotech), 10 μg/ml insulin (Sigma), 0.5 mg/ml 
hydrocortisone (Sigma), 200 U/ml penicillin and 200 μg/ml streptomycin. All imaging 
experiments with MCF10A were done in starving medium consisting in DMEM:F12 
supplemented with 0.3% BSA, 0.5 mg/ml hydrocortisone, 200 U/ml penicillin and 200 
μg/ml streptomycin. For growth factor stimulations, we used human EGF (AF -100, 
Peprotech) and human basic FGF (F0291, Sigma). Chemical perturbations were done 
with SU -5402 (SML0443, Sigma), RAF709 (HY -100510, Lucerna Chem), U0126 
(S1102, Selleck chemicals, Lubio), SCH772984 (HY-50846, Lucerna-Chem), SL0101 
(559285, Sigma), Cyclosporine A (10-1119, Lucerna-chem) and Ionomycin (sc-3592, 
Santa Cruz). Selection of the cells post transfection was done using Puromycin 
(P7255, Sigma), Blasticidin S HCI (5502,  Tocris) and Hygromycin B (sc -29067, Lab 
Force). 
 
Plasmids and stable cell line generation 
The optoFGFR construct was a gift from Won Do Heo (Addgene plasmid # 59776) 
(Kim et a l., 2014). It consists of the myristoylated FGFR1 cytoplasmic region fused 
with the PHR domain of the cryptochrome2 and tagged with mCitrine. It was cloned in 
a lentiviral backbone for stable cell line generation. A modified version of the 
optoFGFR tagged with the red fluorophore mScarlet (Bindels et al., 2017) was cloned 
in a PiggyBac plasmid pMP -PB (blasticidin resistance). The optoSOS construct is a 
modified version of the t RFP-SSPB-SOScat-P2A-iLID-CAAX (Addgene plasmid 
#86439) (Johnson et al., 2017) , in which we replaced the tRFP by mCitrine. The 
construct was cloned in the pPB3.0.Puro, an impro ved PiggyBac plasmid generated 
in our lab with puromycin resistance. The ERK -KTR-mRuby2 and ERK -KTR-
mTurquoise2 reporters were generated by fusing the ERK Kinase Translocation 
Reporter (ERK -KTR) (Regot et al., 2014)  with mRuby2 (Lam et al., 2012)  or 
mTurquoise2 (Goedhart et al., 2012). The nuclear marker H2B-miRFP703 is a fusion 
of the human H2B clustered histone 11 (H2BC11) with the monomeric near -infrared 
fluorescent protein miRFP703 (Shcherbakova et al., 2016)  (Addgene plasmid 
#80001). ERK -KTR-mRuby2, ERK -KTR-mTurquoise2 and H2B -miRFP703 were 
cloned in the PiggyBac plasmids pPB3.0.Hygro, pSB-HPB (gift of David Hacker, 
EPFL, (Balasubramanian et al., 2016) ) and pPB3.0.Blast, respectively. The S/G2/M 
biosensor mCherry-hGeminin was generated by fusing mCherry to the ubiquitylation 
domain of human Geminin (Sakaue-Sawano et al., 2008)  and cloned into the 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
24 
PiggyBac plasmid pSB-HPB. All constructs in PiggyBac plasmids were co-transfected 
with the helper plasmid expressing the transposas e (Yusa et al., 2011)  for stable 
insertion using the jetPEI (Polyplus) transfection reagent for NIH3T3 cells or FuGene 
(Promega) transfection reagent for MCF10A cells. After an tibiotic selection, NIH3T3 
cells were FACS-sorted to generate stable cell lines homogeneously expressing the 
biosensors. In the case of MCF10A cells, clones with uniform biosensor expression 
were isolated. To generate ErbB2 overexpressing MCF10A cells, len tiviral 
transduction using a pHAGE -ERBB2 construct (a gift from Gordon Mills & Kenneth 
Scott, Addgene plasmid #116734) (Ng et al., 2018) was performed in the presence of 
8 μg/ml polybrene (TR1003, Sigma) in cells already expressing H2B -miRFP703 and 
ERK-KTR-mTurquoise2. Cells were further selected with 5 μg/ml puromycin.   
  
Live imaging of ERK dynamics 
NIH3T3 cells were seeded in 96 well 1.5 glass bottom plates (Cellvis) coated  with 10 
μg/ml Fibronectin (Huber lab) using 1.5 x 10 3 cells/well and incubated for 24 hours. 
MCF10A cells were seeded in 24-well 1.5 glass bottom plates (Cellvis) coated with 5 
μg/ml Fibronectin (Huber lab) at 1 x 105 cells/well and incubated for 48 hours. NIH3T3 
cells were washed with PBS and incubated in starving medium for 4 hours in the dark 
before starting the experiment. MCF10A cells were starved for 7 hours (ERK dynamics 
measurements) or at least 24h hours (geminin dynamics measurements) before 
starting the experiments. In experiments involving drug perturbations, cells were 
incubated for 2 hours (or 1 hour in MCF10A experiments) with the inhibitor(s). Imaging 
was performed with an epifluorescence Eclipse Ti inverted fluorescence microscope 
(Nikon) u sing a Plan Apo air 20x (NA 0.8) objective. Nikon Perfect Focus System 
(PFS) was used to keep cells in focus throughout the experiment. Illumination was 
done with a SPECTRA X light engine (Lumencor) with the following filters (Chroma): 
mTurquoise2: 440 nm LED, 470lp, 69308 CFP/YFP/mCherry -ET, CFP 458 -482; 
mCitrine: 508 nm LED, ET500/20x, 69308bs, ET535/30m; mRuby2 and mCherry: 555 
nm LED, ET575/25x, 69008bs, 59022m, miRFP703: 640 nm LED, ET640/30x, 
89100bs Sedat Quad, 84101m Quad. Images were acquired with an Andor Zyla 4.2 
plus camera at a 16 -bit depth. Image acquisition and optogenetic stimulation were 
controlled with the NIS-Element JOBS module. For NIH3T3 experiments, ERK -KTR-
mRuby2 and H2B -miRFP703 were acquired at 1 -minute interval and 470 nm light 
inputs were delivered at specific frequencies and intensities (see below). MCF10A 
image acquisition was performed at 5 -minute time resolution. Growth factor 
stimulations were done by manually pipetting EGF and bFGF during the experiment. 
We used mCitrine inte nsity to quantify the expression level of the optogenetic 
constructs. However, as mCitrine excitation leads to optoFGFR or optoSOS activation, 
we acquired one frame with the ERK -KTR-mRuby2, the H2B -miRFP703 and the 
mCitrine-tagged optoFGFR or optoSOS only at the end of each NIH3T3 experiments. 
All experiments were carried on at 37°C with 5% CO2. 
 
 
 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
25 
Optogenetic stimulation 
Light stimulations were delivered with a 470 nm LED light source that was hardware -
triggered by the camera to generate light pulses of reproducible duration. Light 
stimulations of defined intensity and duration were programmed to be automatically 
delivered at specific timepoints. To defin e the dose of light received by the cells, we 
measured the 470 nm light intensity at the focal plane using an optical power meter 
(X-Cite Power Meter, Lumen Dynamics Group) and converted this value to a power 
density as 
 
𝐿𝑖𝑔ℎ𝑡	𝑝𝑜𝑤𝑒𝑟	𝑑𝑒𝑛𝑠𝑖𝑡𝑦	 = 𝐿𝑖𝑔ℎ𝑡	𝑖𝑛𝑡𝑒𝑛𝑠𝑖𝑡𝑦	 × 1
𝜋 × ( 𝐹𝑁
2 × 𝑀𝑎𝑔𝑛𝑖𝑓𝑖𝑐𝑎𝑡𝑖𝑜𝑛)>
	[𝑚𝑊
𝑐𝑚>] 
 
with FN = 18 mm. The obtained value was then multiplied by the duration of the pulse 
to obtain the dose of light received by the cells for each light pulse.  
 
𝐿𝑖𝑔ℎ𝑡	𝑑𝑜𝑠𝑒	 = 	𝐿𝑖𝑔ℎ𝑡	𝑝𝑜𝑤𝑒𝑟	𝑑𝑒𝑛𝑠𝑖𝑡𝑦	 × 	𝑃𝑢𝑙𝑠𝑒	𝑑𝑢𝑟𝑎𝑡𝑖𝑜𝑛	 =	[𝑚𝑊 × 𝑠
𝑐𝑚> ]	=	[ 𝑚𝐽
𝑐𝑚>] 
  
For stimulation of the optoFGFR cells, the 470 nm LED intensity was limited to a low 
dose by combining a ZET470/10x filter and a ND filter 5% (Chroma). Transient 
stimulations were done with a single pulse, while sustained stimulations were done 
with single pulses delivered every 2 minutes. For stimulation of the optoSOS cells, we 
used the 470 nm LED with a ET470/24x filter (no ND filter). Transient stimulations 
were done with 5 pulses repeated at 20-second intervals, while sustained stimulations 
were done using 5 pulses of light repeated at 20-second intervals, delivered every 2 
minutes. 
 
Figures System Power 
density 
Pulse duration Dose Stimulation 
pattern 
1B-C,  
S1A,S1D 
optoFGFR 180 mW/cm2 100 ms 18 mJ/cm2 transient  
S1B-C optoFGFR 
(mScarlet) 
> 180 mW/cm2 100 ms > 18 mJ/cm2 transient 
2A-B optoFGFR variable variable variable transient 
2C optoFGFR 180 mW/cm2 100 ms 18 mJ/cm2 variable 
2D-
E,S2E,S3
B,S3K,3B,
3D-E,S4C-
D,S5A-
D,4E,5B,6
optoFGFR 180 mW/cm2 100 ms 18 mJ/cm2 sustained 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
26 
A-H,S7A-
D 
2F optoFGFR variable 100 ms variable sustained  
4B optoSOS 6 W/cm2 variable x 100 
ms (20 sec 
interval) 
0.6 J/cm2 transient 
S6A optoSOS variable variable x 
100ms (20-sec 
interval) 
variable transient 
4C optoSOS 6 W/cm2 5 x 100 ms (20-
sec interval) 
0.6 J/cm2 variable 
4D optoSOS variable 5 x 100 ms (20-
sec interval) 
variable sustained 
4E,S6B,S6
C-D,5A-
C,6A-D 
optoSOS 6 W/cm2 5 x 100 ms (20-
sec interval) 
0.6 J/cm2 sustained 
 
TIRF imaging of optoFGFR dynamics 
Cells were seeded at a density of 1 x 10 3 per well in 96 well 1.5 glass bottom plates 
(Cellvis) coated with 10 μg/ml Fibronectin (Huber lab) and incubated for 24 hours at 
37°C with 5% CO 2. Before imaging, cells were washed with PBS and incubated in 
starving medium for 4 hours in the dark. Imaging was performed with an 
epifluorescence Eclipse Ti inverted fluorescence microscope (Nikon) using a CFI 
Apochromat TIRF 100x oil (NA 1.4 9). Images were acquired with an Andor Zyla 4.2 
plus camera at a 16-bit depth. TIRF images were acquired with a 561 nm laser using 
a ET575/25 filter in front of the ZT488/561rpc (Chroma) to prevent nonspecific             
activation of the CRY2. MetaMorph software (Universal Imaging) was used for 
acquisition. TIRF images of the optoFGFR -mScarlet were acquired at a 20 -second 
interval. Optogenetic stimulation was done using a 470 nm LED (SPECTRA X, 
Lumencor) (Figure S1B-C). All experiments were carried on at 37°C with 5% CO2. 
  
Image processing pipeline 
Nuclear segmentation was done in CellProfiler 3.0 (McQuin et al., 2018)  using a 
threshold-based approach of the H2B channel. In the case of MCF10A cells, nuclear 
segmentation was preceded by prediction of nuclear probability using a random forest 
classifier based on different pixel features available in Ilastik software (Berg et al., 
2019). To measure the ERK -KTR fluorescence in the cytosol, the nuclear mask was 
first expanded by 2 pixels to exclude the blurred edges of the nucleus. The new mask 
was then further expanded by 4 pixels in a threshold-based manner in order to obtain 
a “ring” area corresponding to the cytoplasmic ERK -KTR. ERK activity was obtained 
by calculating the ratio between the average cytosolic pixel intensity and the average 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
27 
nuclear pixel intensity. Single -cell tracking was done on nuclear centroids with 
MATLAB using μ-track 2.2.1 (Jaqaman et al., 2008). The final images containing the 
ERK-KTR-mRuby2, H2B-miRFP703 and the optoFGFR -mCitrine (or optoSOS -
mCitrine) channels were processed using the same CellProfiler settings as the time 
lapse images. Intensity of the mCitrine was extracted using the ERK-KTR cytoplasmic 
mask and used to classify cells into low or high expressors in a threshold -based 
manner. For optoFGFR-evoked ERK responses, the threshold was defined empirically 
to separate oscillatory and non-oscillatory ERK responses (low < -1.75 (log10 mCitrine 
intensity) < high). For optoSOS -evoked ERK r esponses, the threshold was defined 
empirically to separate cells with low or high ERK response amplitudes (low < -1.25 
(log10 mCitrine intensity) < high). The same thresholds were kept across experiments 
to compare low and high expressors. 
The optoFGFR -mScarlet dimers/oligomers were segmented using the pixel 
classification module from Ilastik (Berg et al., 2019) . OptoFGFR dimers, cell 
background and trafficking vesicles were m anually annotated on images before and 
after the light stimulation. A probability map of the optoFGFR dimers classification was 
exported as TIFF for each frame. We then computed the mean of pixel intensities from 
the binarized mask obtained with Ilastik using Fiji (Figure S1B,C).  
  
Quantification of ERK activity and cell-cycle 
We wrote a set of custom R scripts to automatically calculate the ERK -KTR 
cytoplasmic/nuclear ratio as a proxy for ERK activity for each single -cell, link single-
cell ERK responses w ith the corresponding optoFGFR/optoSOS intensity value and 
export the corresponding ERK single -cell trajectories. For NIH3T3 data, outliers in 
ERK single -cell trajectories were removed using a clustering -based approach 
(https://github.com/pertzlab/Outlier_app). Trajectories with an ERK -KTR 
cytoplasmic/nuclear ratio higher than 0.8 or lower than 0.2 before stimulation, above 
1.6 during the whole experiment or displaying single time point spiking valu es were 
removed. For MCF10A data, trajectories with an ERK -KTR cytoplasmic/nuclear ratio 
above 2 or shorter than 90% of the total experiment duration were removed. All the R 
codes used for further analysis are available as supplementary information. 
Hierarchical clustering analysis of single-cell trajectories (Figure 2D,S5F,G,S6B,7J,K) 
was done using Time Course Inspector (Dobrzyński et al., 2019).  
  
Modeling 
The model for the  EGF and light stimulated ERK cascade is a kinetic model, 
representing the EGF receptor, the inter -cellular proteins (RAS, RAF, MEK, ERK) as 
well as a negative feedback from ERK to RAF and the inactivation of the EGF receptor 
in the form of endocytosis (Figure S3A). We explicitly modelled the ERK-KTR readout 
through nuclear and cytosolic KTR. The initial fraction of cytosolic KTR is estimated 
from the data through the parameter 𝑘𝑡𝑟HIHJ. The KTR readout 𝑌(𝑡) was taken to be 
the ratio of cytosolic KTR over nuclear KTR with additive Gaussian noise 
  
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
28 
𝑌(𝑡)	=	
LMN
LMN∗ + 𝜖  
 
𝜖 ∼ 𝑁𝑜𝑟𝑚𝑎𝑙(0, 𝜎2) 
  
where the variance of the measurement noise 𝜎> was estimated from the data.  
Table S1 shows all modelled species, their notation used for the equation, as well as 
the initial values. We assume that in the beginning of the experiment, all species are 
in the inactive form, reflecting the fact that the cells have been starved. The total 
concentrations of all species have been normalized to 1. The model equations are 
shown in Table S2. The phosphorylation events are modelled with Michaelis-Menten 
kinetics. The negative feedback is modelled through the modeling species 𝑁𝐹𝐵 and 
its “active” version 𝑁𝐹𝐵∗ which affects the dephosphorylation rate of 𝑅𝐴𝐹 linearly. The 
activation, endocytosis and recycling of the EGF receptor is modelled linearly. The 
model parameters are described in Table S3. For the modeling of the two smaller 
models (without feedback (Figure S3E) or without endocytosis (Figure S3H)), we set 
the corresponding parameters (𝑘IYZ and 𝑟>,[) to zero.  
For the parameter inference we used a Nested Sampling algorithm as described in 
(Mikelson and Khammash, 2020). The inference was performed on the ETH High-
performance Cluster Euler and was done using the parallel implementation on 48 
cores. The algorithm was run for 24 hours or until the algorithm stopped because the 
termination criterion 𝛥]^_` (see (Mikelson and Khammash, 2020) for details) was −∞. 
As prior distributions we chose for all parameters non-informative log-uniform priors 
between 10-5 and 105, except for 𝑘𝑡𝑟HIHJ for which we chose a uniform prior on the 
interval [0, 1] and for 𝜎 for which we chose a log-uniform prior between 10-5 and 1. 
Predictive distributions can be found on Figure S3C,D,F,G,I,J. 
 
RNAi perturbation screen 
We used Ingenuity Pathway Analysis (IPA, Qiagen) to select proteins directly 
interacting with ERK, MEK, RAF, RAS and FGFR, that are known to be expressed in 
NIH3T3 cells using a proteomics approach (Jensen et al., 2009; Schwanhäusser et 
al., 2011) (Table S4). We then imported this protein list in STRING (Jensen et al., 
2009) to generate an interaction network with a minimum interaction score of 0.4 
(Figure 3A). We targeted these selected proteins with RNA interference, using the 
siPOOL technology (one siPOOL containing a mix of 30 siRNAs targeting the same 
gene (Hannus et al., 2014), sequences available in supplementary). We arranged the 
siPOOLs in a 96 well plate format (in columns 2-5 and 8-11, one well per siPOOL) with 
the non-targeting siRNA (CTRL) and the positive control (mix of 5 nM siPOOL against 
ERK1 and 5 nM siPOOL against ERK2) placed alternately in columns 1, 6, 7 and 12. 
Cells were reverse transfected using RNAiMAX (Thermofischer, 13778150) following 
the recommended siPOOL transfection protocol. OptoFGFR-expressing cells were 
transfected with 10 nM of siPOOL in a 96 well 1.5 glass bottom plate (Cellvis) coated 
with 10 μg/ml Fibronectin (Huber Lab) at 0.3 x 103 cells/well density and incubated for 
72 hours at 37°C and 5% CO2. For the imaging, the 96 well plate was divided into 15 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
29 
sub-experiments, each sub-experiment consisting of a negative control well, a positive 
control well and 4 wells with different siPOOLs. We selected 2 FOVs per well and 
programmed the microscope to run the 15 experiments seq uentially, acquiring the 
ERK-KTR-mRuby2 and the H2B -miRFP703 channels with a 1 -minute interval, 
stimulating the cells with sustained optoFGFR inputs (2 -minute intervals, 18mJ/cm2), 
and acquiring a final frame with ERK -KTR-mRuby2, H2B-miRFP703 and optoFGFR-
mCitrine (Figure 3B,D,E,S4C,D,S5A-D,5B,6E-H). For the optoSOS system, we limited 
the perturbation screen to targets acting below RAS (Figure 5A -C,S6C,D). 
Stimulations were done with sustained optoSOS inputs (2 -minute intervals, 5 x 0.6 
J/cm2). For EGF stimulation, cells were stimulated with 1 ng/ml EGF at t = 5 minutes 
(Figure S5E-G).  
  
Real-time qPCR 
Cells were transfected with different concentrations of siPOOL in a 24 well plate at 5 
x 103 cells/well density and incubated at 37°C with 5% CO 2 for 72 hours before RNA 
isolation. Reverse transcription was done with the ProtoScript II reverse transcriptase 
kit (Bioconcept, M0368L). Real-time qPCR reactions were run using the MESA Green 
pPCR MasterMix Plus for SYBR Green assay (Eurogenetec, RT -SY2X-03+WOU) on 
the Rotor-Gen Q device (Qiagen). Each sample was tested in triplicate. Expression 
level of the gene of interest was calculated using the 2 -ΔΔCt method with GAPDH 
expression level as internal control (Figure S4A). The following primers were used for 
the RT -qPCR reaction (designed with the Real -time PCR (TaqMan) Primer and 
Probes Design Tool from GenScript). 
  
Target Forward sequences Reverse sequences 
ERK1 5’-GGTTGTTCCCAAATGCTGACT-3’ 5’-CAACTTCAATCCTCTTGTGAGGG-3’ 
ERK2 5’-TCCGCCATGAGAATGTTATAGGC-3’ 5’-GGTGGTGTTGATAAGCAGATTGG-3’ 
MEK1 5’-AAGGTGGGGGAACTGAAGGAT-3’ 5’-CGGATTGCGGGTTTGATCTC-3’ 
MEK2 5’-GTTACCGGCACTCACTATCAA C-3’ 5’-CCTCCAGCCGCTTCCTTTG-3’ 
GAPDH 5'-ACCCAGAAGACTGTGGATGG-3' 5'-TCAGCTCAGGGATGACCTTG-3' 
  
Immunoblotting 
Cells were transfected with 10 nM siPOOL in 6 well plates at 6 x 104 cells/well density 
and incubated at 37°C with 5% CO 2 for 72 hours. Cells were lysed in a buffer 
containing 10 mM Tris HCl, 1 mM EDTA and 1% SD S. Protein concentration was 
determined with the BCATM protein assay kit (ThermoFisher, 23227). Home cast 10% 
SDS gels or Novex 4% -20% 10 well Mini Gels (Thermofisher, XP04200) were used 
for SDS page. Transfer was done using PVDF membranes and a Trans-Blot SD Semi-
Dry Electrophoretic Transfer Cell (Bio -Rad). Imaging was done with an Odyssey 
Fluorescence scanner (Li -COR) (Figure 3C, S4B). The following primary antibodies 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
30 
were used: anti-total ERK (M7927, Sigma), anti-MEK1 (ab32091, Abcam), anti-MEK2 
(ab32517, Abcam), anti -BRAF (sc -5284, Santa Cruz), anti -CRAF (9422S, Cell 
Signaling Technology), anti -SOS1 (610096, Biosciences), anti -GRB2 (PA5 -17692, 
Invitrogen). Anti-GAPDH (sc-32233, Santa Cruz) was used as protein of reference. 
For the secondary antibodies, we used the IRDye 680LT donkey anti-mouse IgG (926-
68022, Li -COR), IRDye 800CW goat anti -mouse (926 -32210, Li -COR) and IRDye 
800CW donkey anti-rabbit (926-32213, Li-COR). Protein detection was done with the 
Image StudioTM Lite software.  
 
Time-series feature extraction 
We used custom scripts to extract features of ERK responses to transient optogenetic 
inputs (Figure 2B,S6A) and to sustained GF inputs (Figure S2B,D). The maximum 
peak (maxPeak) is the absolute value of the highest ERK activity in the trajectory. To 
estimate the full width at half maximum (FWHM), we first removed the baseline of the 
trajectories and increased their sampling frequency by a factor 30 with spline 
interpolation. On the resulting trajectory, we applied a “walk” procedure to quantify the 
FWHM. In this method, a pointer walks left and right ( i.e. opposite and along the 
direction of time respectively) from the maximum point of the trajectory. The pointer 
stops whenever the half maximum value is crossed. Both stops define a left and a right 
border, the time difference between these 2 -border time-points gives the FWHM. To 
avoid reporting aberrant FWHM values in cases where a peak cannot be clearly 
defined, we excluded FWHM calculation for trajectories where the fold chang e 
between the baseline (mean activity before stimulation) and the maximum value of the 
trajectory was below a threshold manually defined.  
To evaluate ERK amplitude in response to sustained high optoFGFR or optoSOS 
inputs (Figure 3D,4E,5A,B), we extracted the maxPeak from a fixed number of single-
cell ERK trajectories within a 10 minutes time window following the start of the 
stimulation. The maxPeak value was plotted as violin plots for each condition. For the 
comparison of both optogenetic systems (Figure 4E), statistical analysis was done by 
comparing low and high expressing cells within and across optogenetic systems with 
a Wilcoxon test using the FDR p -value correction (*<0.05, **<0.005, ***<0.0005, 
****<0.00005). For the RNAi perturbations (Figure 3D,5 A), statistical analysis was 
done for each optogenetic system by comparing each perturbation to the negative 
control ( CTRL) with a Wilcoxon test using the FDR p -value correction (*<0.05, 
**<0.005, ***<0.0005, ****<0.00005). The obtained maxPeak for each si RNA 
perturbation was then z-scored to the non-targeting siRNA (CTRL) (Figure 5B).  
To quantify the efficiency of the MEK inhibitor (U0126) on the reduction of ERK activity 
under sustained high optoFGFR or optoSOS inputs, extraction of the maxPeak was 
limited by the fact that several U0126 concentrations led to a full suppression of ERK 
amplitudes. Therefore, we extracted ERK amplitudes at a fixed time point (tfixed optoFGFR 
= 10 minutes, t fixed optoSOS = 7 minutes), which correspond to the maximal ERK 
amplitudes in the control condition (no U0126). The obtained ERK amplitudes were 
then plotted per U0126 concentration (Figure 6B,F,S7B). The spreading of ERK 
amplitude at the fixed time point was evaluated by computing the standard deviation 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
31 
of the extracted ER K activity per condition (Figure 6C,G,S7C). The IC50 was 
calculated by fitting a Hill function to the mean ERK activity of each concentration 
(Figure 6D,H,S7D). 
 
Identification of ERK dynamics phenotypes using CODEX  
We first trained a convolutional neural network (CNN) to classify input ERK trajectories 
into any of the siRNA-perturbed conditions (Figure S5A). For this purpose, we used a 
CNN architecture composed of 4 1D -convolution layers with 20 kernels of size 5, 
followed by a convolution layer with 20 k ernels of size 3 and one layer of 10 kernels 
of size 3. The responses are then pooled with global average pooling to generate a 
vector of 10 features that is passed to a (10,63) fully connected layer for classification. 
Each convolutional layer is followed by ReLU and batch normalization. The CNN was 
trained to minimize the cross-entropy loss, with L2 weight penalty of 1e-3. 
In order to identify siRNA treatments that induced a distinctive phenotype, we selected 
the 10 conditions for which the CNN classifica tion precision was the highest on the 
validation set (Table S4, “CODEX accuracy”). To these 10 conditions, we also added 
the negative control (non -targeting siRNA ( CTRL)). We trained a second CNN, with 
the same architecture and training parameters, but lim ited to recognizing the 11 
selected treatments in order to obtain a clear embedding of these hits. With this new 
model, we extracted the features used for the classification of the trajectories (i.e. the 
input representation after the last convolution laye r) and projected them with tSNE 
(Python’s sklearn implementation, perplexity of 100, learning rate of 600 and 2500 
iterations) (Figure S5B). We selected 10 prototype curves for each treatment by taking 
the trajectories for which the second CNN’s classification confidence ( i.e. the 
probability for the act ual class of the inputs) were the highest in the validation set 
(Figure 3E). 
To visualize the ERK dynamics landscape in MCF10A WT cells and in MCF10A cells 
with ErbB2 overexpression, we trained one CNN for each cell line. These CNNs were 
trained to recognize the drug treatment applied on cells, using single -cell ERK traces 
as input. The architecture of the CNNs is the same as described previously. The only 
difference lies in the number of outputs in the final fully connected layer, which were 
set to the num ber of drug treatments. Features used for the classification of the 
trajectories were then projected with tSNE (Figure 7D,E,G,H). Clusters were manually 
defined in regions of the tSNE with a high density of points. We used the interactive 
CODEX application  to visualize the trajectories associated with each cluster and 
manually selected representative trajectories (Figure 7F,I). 
 
Peak detection and classification of oscillatory trajectories 
The number of ERK activity peaks was calculated with a custom algorithm that detects 
local maxima in time series. First, we applied a short median filter to smoothen the 
data with a window width of 3 time points. Then, we ran a long median filter to estimate 
the long-term bias with a window width of 15 time points. This bias was then subtracted 
from the smoothed time series and we only kept the positive values. If no point in this 
processed trajectory was exceeding a manual threshold of 0.075, all variations were 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
32 
considered as noise and no peak was extracted from the trajec tory. The remaining 
trajectories were then rescaled to [0,1]. Finally, peaks were detected as points that 
exceeded a threshold which was manually set to 0.1. Peaks that were found before 
the first stimulation or after the last stimulation were filtered out. 
The classification of trajectories into oscillatory and non -oscillatory behaviors was 
performed after the peak detection step. Cells were called oscillatory if at least 3 peaks 
were detected with the peak detection procedure (Figure S5D). Statistical ana lysis 
was done using a pairwise t -test comparing each perturbation to the control for high 
and low levels of optoFGFR independently, with FDR p -value correction (*<0.05, 
**<0.005, ***<0.0005, ****<0.00005). 
Acknowledgement 
  
This work was supported by SystemsX.ch, Swiss Cancer League and Swiss National 
Science Foundation grants to Olivier Pertz and by the European Union’s Horizon 2020 
and innovation program under grant agreement No. 730964 (TRANSVAC project) to 
Mustafa Khammash. We thank Won Do Heo for shar ing the optoFGFR plasmid and 
David Hacker for sharing the pSB -HPB plasmid. We thank the Microscopy Imaging 
Center of the University of Bern for its support.  
Authors contribution 
  
O.P. and C.D. designed the study. C.D. developed the optogenetic systems an d 
imaging pipelines. CD performed the experiment and image analysis on NIH3T3. A.F 
and P.A.G. performed the experiments and image analysis on MCF10A. M.D. 
developed the processing pipelines. C.D processed the data. C.D., M. -A.J., A.F and 
P.A.G. analyzed th e data. M. -A.J. conducted the CNN analysis. J.M. performed 
mathematical modeling. O.P and M.K. supervised the work. O.P., C.D. and J.M. wrote 
the paper.  
 
Conflict of interest 
  
The authors declare having no conflict of interest. 
 
  
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
33 
Bibliography 
Albeck, J.G., Mills, G.B., and Brugge, J.S. (2013). Frequency-modulated pulses of ERK 
activity transmit quantitative proliferation signals. Mol. Cell 49, 249–261. 
Arkun, Y., and Yasemi, M. (2018). Dynamics and control of the ERK signaling pathway: 
Sensitivity, bistability, and oscillations. PLoS ONE 13, e0195513. 
Arteaga, C.L., and Engelman, J.A. (2014). ERBB receptors: from oncogene discovery to 
basic science to mechanism-based cancer therapeutics. Cancer Cell 25, 282–303. 
Avraham, R., and Yarden, Y. (2011). Feedback regulation of EGFR signalling: decision 
making by early and delayed loops. Nat. Rev. Mol. Cell Biol. 12, 104–117. 
Balasubramanian, S., Wurm, F.M., and Hacker, D.L. (2016). Multigene expression in stable 
CHO cell pools generated with the piggyBac transposon system. Biotechnol. Prog. 32, 
1308–1317. 
Belov, A.A., and Mohammadi, M. (2012). Grb2, a double-edged sword of receptor tyrosine 
kinase signaling. Sci. Signal. 5, pe49. 
Benedetti, L., Barentine, A.E.S., Messa, M., Wheeler, H., Bewersdorf, J., and De Camilli, P. 
(2018). Light-activated protein interaction with high spatial subcellular confinement. Proc Natl 
Acad Sci USA 115, E2238–E2245. 
Berg, S., Kutra, D., Kroeger, T., Straehle, C.N., Kausler, B.X., Haubold, C., Schiegg, M., 
Ales, J., Beier, T., Rudy, M., et al. (2019). ilastik: interactive machine learning for (bio)image 
analysis. Nat. Methods 16, 1226–1232. 
Bindels, D.S., Haarbosch, L., van Weeren, L., Postma, M., Wiese, K.E., Mastop, M., 
Aumonier, S., Gotthard, G., Royant, A., Hink, M.A., et al. (2017). mScarlet: a bright 
monomeric red fluorescent protein for cellular imaging. Nat. Methods 14, 53–56. 
Blum, Y., Mikelson, J., Dobrzyński, M., Ryu, H., Jacques, M.-A., Jeon, N.L., Khammash, M., 
and Pertz, O. (2019). Temporal perturbation of ERK dynamics reveals network architecture 
of FGF2/MAPK signaling. Mol. Syst. Biol. 15, e8947. 
Blüthgen, N., and Legewie, S. (2013). Robustness of signal transduction pathways. Cell. 
Mol. Life Sci. 70, 2259–2269. 
Casalvieri, K.A., Matheson, C.J., Backos, D.S., and Reigan, P. (2017). Selective targeting of 
RSK isoforms in cancer. Trends Cancer 3, 302–312. 
Chardin, P., Camonis, J.H., Gale, N.W., van Aelst, L., Schlessinger, J., Wigler, M.H., and 
Bar-Sagi, D. (1993). Human Sos1: a guanine nucleotide exchange factor for Ras that binds 
to GRB2. Science 260, 1338–1343. 
Cherfils, J., and Zeghouf, M. (2013). Regulation of small GTPases by GEFs, GAPs, and 
GDIs. Physiol. Rev. 93, 269–309. 
Cullen, P.J., and Lockyer, P.J. (2002). Integration of calcium and Ras signalling. Nat. Rev. 
Mol. Cell Biol. 3, 339–348. 
Dobrzyński, M., Jacques, M.-A., and Pertz, O. (2019). Mining single-cell time-series datasets 
with Time Course Inspector. Bioinformatics. 
Douville, E., and Downward, J. (1997). EGF induced SOS phosphorylation in PC12 cells 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
34 
involves P90 RSK-2. Oncogene 15, 373–383. 
Duan, L., Hope, J., Ong, Q., Lou, H.-Y., Kim, N., McCarthy, C., Acero, V., Lin, M.Z., and Cui, 
B. (2017). Understanding CRY2 interactions for optical control of intracellular signaling. Nat. 
Commun. 8, 547. 
Erickson, K.E., Rukhlenko, O.S., Posner, R.G., Hlavacek, W.S., and Kholodenko, B.N. 
(2019). New insights into RAS biology reinvigorate interest in mathematical modeling of RAS 
signaling. Semin. Cancer Biol. 54, 162–173. 
Ferrell, J.E., and Bhatt, R.R. (1997). Mechanistic studies of the dual phosphorylation of 
mitogen-activated protein kinase. J. Biol. Chem. 272, 19008–19016. 
Fritsche-Guenther, R., Witzel, F., Sieber, A., Herr, R., Schmidt, N., Braun, S., Brummer, T., 
Sers, C., and Blüthgen, N. (2011). Strong negative feedback from Erk to Raf confers 
robustness to MAPK signalling. Mol. Syst. Biol. 7, 489. 
Gagliardi, P.A., Dobrzyński, M., Jacques, M.A., Dessauges, C., Ender, P., Blum, Y., Hughes, 
R.M., Cohen, A.R., and Pertz, O. (2021). Collective ERK/Akt activity waves orchestrate 
epithelial homeostasis by driving apoptosis-induced survival. Dev. Cell 56, 1712-1726.e6. 
Goedhart, J., von Stetten, D., Noirclerc-Savoye, M., Lelimousin, M., Joosen, L., Hink, M.A., 
van Weeren, L., Gadella, T.W.J., and Royant, A. (2012). Structure-guided evolution of cyan 
fluorescent proteins towards a quantum yield of 93%. Nat. Commun. 3, 751. 
Gotoh, N. (2008). Regulation of growth factor signaling by FRS2 family docking/scaffold 
adaptor proteins. Cancer Sci. 99, 1319–1325. 
Hannus, M., Beitzinger, M., Engelmann, J.C., Weickert, M.-T., Spang, R., Hannus, S., and 
Meister, G. (2014). siPools: highly complex but accurately defined siRNA pools eliminate off-
target effects. Nucleic Acids Res. 42, 8049–8061. 
Huang, C.-Y., and Tan, T.-H. (2012). DUSPs, to MAP kinases and beyond. Cell Biosci. 2, 
24. 
Jacques, M.A., Dobrzyński, M., Gagliardi, P.A., Sznitman, R., and Pertz, O. (2021). CODEX, 
a neural network approach to explore signaling dynamics landscapes. Mol. Syst. Biol. 17, 
e10026. 
Jaqaman, K., Loerke, D., Mettlen, M., Kuwata, H., Grinstein, S., Schmid, S.L., and Danuser, 
G. (2008). Robust single-particle tracking in live-cell time-lapse sequences. Nat. Methods 5, 
695–702. 
Jensen, L.J., Kuhn, M., Stark, M., Chaffron, S., Creevey, C., Muller, J., Doerks, T., Julien, P., 
Roth, A., Simonovic, M., et al. (2009). STRING 8--a global view on proteins and their 
functional interactions in 630 organisms. Nucleic Acids Res. 37, D412-6. 
Johnson, H.E., Goyal, Y., Pannucci, N.L., Schüpbach, T., Shvartsman, S.Y., and Toettcher, 
J.E. (2017). The spatiotemporal limits of developmental erk signaling. Dev. Cell 40, 185–
192. 
Junttila, M.R., Li, S.-P., and Westermarck, J. (2008). Phosphatase-mediated crosstalk 
between MAPK signaling pathways in the regulation of cell survival. FASEB J. 22, 954–965. 
Kholodenko, B.N. (2000). Negative feedback and ultrasensitivity can bring about oscillations 
in the mitogen-activted protein kinase cascades. Eur. J. Biochem 267, 1583–1588. 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
35 
Kholodenko, B.N., Hancock, J.F., and Kolch, W. (2010). Signalling ballet in space and time. 
Nat. Rev. Mol. Cell Biol. 11, 414–426. 
Kim, N., Kim, J.M., Lee, M., Kim, C.Y., Chang, K.-Y., and Heo, W.D. (2014). Spatiotemporal 
control of fibroblast growth factor receptor signals by blue light. Chem. Biol. 21, 903–912. 
Kochańczyk, M., Kocieniewski, P., Kozłowska, E., Jaruszewicz-Błońska, J., Sparta, B., 
Pargett, M., Albeck, J.G., Hlavacek, W.S., and Lipniacki, T. (2017). Relaxation oscillations 
and hierarchy of feedbacks in MAPK signaling. Sci. Rep. 7, 38244. 
Koseska, A., and Bastiaens, P.I.H. (2020). Processing temporal growth factor patterns by an 
epidermal growth factor receptor network dynamically established in space. Annu. Rev. Cell 
Dev. Biol. 36, 359–383. 
Kupzig, S., Walker, S.A., and Cullen, P.J. (2005). The frequencies of calcium oscillations are 
optimized for efficient calcium-mediated activation of Ras and the ERK/MAPK cascade. Proc 
Natl Acad Sci USA 102, 7577–7582. 
Lake, D., Corrêa, S.A.L., and Müller, J. (2016). Negative feedback regulation of the ERK1/2 
MAPK pathway. Cell. Mol. Life Sci. 73, 4397–4413. 
Lam, A.J., St-Pierre, F., Gong, Y., Marshall, J.D., Cranfill, P.J., Baird, M.A., McKeown, M.R., 
Wiedenmann, J., Davidson, M.W., Schnitzer, M.J., et al. (2012). Improving FRET dynamic 
range with bright green and red fluorescent proteins. Nat. Methods 9, 1005–1012. 
Langlois, W.J., Sasaoka, T., Saltiel, A.R., and Olefsky, J.M. (1995). Negative feedback 
regulation and desensitization of insulin- and epidermal growth factor-stimulated p21ras 
activation. J. Biol. Chem. 270, 25320–25323. 
Lavoie, H., Gagnon, J., and Therrien, M. (2020). ERK signalling: a master regulator of cell 
behaviour, life and fate. Nat. Rev. Mol. Cell Biol. 21, 607–632. 
McQuin, C., Goodman, A., Chernyshev, V., Kamentsky, L., Cimini, B.A., Karhohs, K.W., 
Doan, M., Ding, L., Rafelski, S.M., Thirstrup, D., et al. (2018). CellProfiler 3.0: Next-
generation image processing for biology. PLoS Biol. 16, e2005970. 
Mikelson, J., and Khammash, M. (2020). Likelihood-free nested sampling for parameter 
inference of biochemical reaction networks. PLoS Comput. Biol. 16, e1008264. 
Nakakuki, T., Birtwistle, M.R., Saeki, Y., Yumoto, N., Ide, K., Nagashima, T., Brusch, L., 
Ogunnaike, B.A., Okada-Hatakeyama, M., and Kholodenko, B.N. (2010). Ligand-specific c-
Fos expression emerges from the spatiotemporal control of ErbB network dynamics. Cell 
141, 884–896. 
Ng, P.K.-S., Li, J., Jeong, K.J., Shao, S., Chen, H., Tsang, Y.H., Sengupta, S., Wang, Z., 
Bhavana, V.H., Tran, R., et al. (2018). Systematic functional annotation of somatic mutations 
in cancer. Cancer Cell 33, 450-462.e10. 
Ornitz, D.M., and Itoh, N. (2015). The Fibroblast Growth Factor signaling pathway. Wiley 
Interdiscip. Rev. Dev. Biol. 4, 215–266. 
Orton, R.J., Sturm, O.E., Vyshemirsky, V., Calder, M., Gilbert, D.R., and Kolch, W. (2005). 
Computational modelling of the receptor-tyrosine-kinase-activated MAPK pathway. Biochem. 
J. 392, 249–261. 
Patterson, K.I., Brummer, T., O’Brien, P.M., and Daly, R.J. (2009). Dual-specificity 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
36 
phosphatases: critical regulators with diverse cellular targets. Biochem. J. 418, 475–489. 
Purvis, J.E., and Lahav, G. (2013). Encoding and decoding cellular information through 
signaling dynamics. Cell 152, 945–956. 
Rauen, K.A. (2013). The RASopathies. Annu. Rev. Genomics Hum. Genet. 14, 355–369. 
Regot, S., Hughey, J.J., Bajar, B.T., Carrasco, S., and Covert, M.W. (2014). High-sensitivity 
measurements of multiple kinase activities in live single cells. Cell 157, 1724–1734. 
Ryu, H., Chung, M., Dobrzyński, M., Fey, D., Blum, Y., Lee, S.S., Peter, M., Kholodenko, 
B.N., Jeon, N.L., and Pertz, O. (2015). Frequency modulation of ERK activation dynamics 
rewires cell fate. Mol. Syst. Biol. 11, 838. 
Saha, M., Carriere, A., Cheerathodi, M., Zhang, X., Lavoie, G., Rush, J., Roux, P.P., and 
Ballif, B.A. (2012). RSK phosphorylates SOS1 creating 14-3-3-docking sites and negatively 
regulating MAPK activation. Biochem. J. 447, 159–166. 
Sakaue-Sawano, A., Kurokawa, H., Morimura, T., Hanyu, A., Hama, H., Osawa, H., 
Kashiwagi, S., Fukami, K., Miyata, T., Miyoshi, H., et al. (2008). Visualizing spatiotemporal 
dynamics of multicellular cell-cycle progression. Cell 132, 487–498. 
Samatar, A.A., and Poulikakos, P.I. (2014). Targeting RAS-ERK signalling in cancer: 
promises and challenges. Nat. Rev. Drug Discov. 13, 928–942. 
Santos, S.D.M., Verveer, P.J., and Bastiaens, P.I.H. (2007). Growth factor-induced MAPK 
network topology shapes Erk response determining PC-12 cell fate. Nat. Cell Biol. 9, 324–
330. 
Schlessinger, J. (2000). Cell signaling by receptor tyrosine kinases. Cell 103, 211–225. 
Schmick, M., Kraemer, A., and Bastiaens, P.I.H. (2015). Ras moves to stay in place. Trends 
Cell Biol. 25, 190–197. 
Schwanhäusser, B., Busse, D., Li, N., Dittmar, G., Schuchhardt, J., Wolf, J., Chen, W., and 
Selbach, M. (2011). Global quantification of mammalian gene expression control. Nature 
473, 337–342. 
Shankaran, H., Ippolito, D.L., Chrisler, W.B., Resat, H., Bollinger, N., Opresko, L.K., and 
Wiley, H.S. (2009). Rapid and sustained nuclear-cytoplasmic ERK oscillations induced by 
epidermal growth factor. Mol. Syst. Biol. 5, 332. 
Shcherbakova, D.M., Baloban, M., Emelyanov, A.V., Brenowitz, M., Guo, P., and Verkhusha, 
V.V. (2016). Bright monomeric near-infrared fluorescent proteins as tags and biosensors for 
multiscale imaging. Nat. Commun. 7, 12405. 
Smith, J.A., Poteet-Smith, C.E., Xu, Y., Errington, T.M., Hecht, S.M., and Lannigan, D.A. 
(2005). Identification of the first specific inhibitor of p90 ribosomal S6 kinase (RSK) reveals 
an unexpected role for RSK in cancer cell proliferation. Cancer Res. 65, 1027–1034. 
Sturm, O.E., Orton, R., Grindlay, J., Birtwistle, M., Vyshemirsky, V., Gilbert, D., Calder, M., 
Pitt, A., Kholodenko, B., and Kolch, W. (2010). The mammalian MAPK/ERK pathway 
exhibits properties of a negative feedback amplifier. Sci. Signal. 3, ra90. 
Wei, W., Jiao, Y., Postlethwaite, A., Stuart, J.M., Wang, Y., Sun, D., and Gu, W. (2013). 
Dual-specificity phosphatases 2: surprising positive effect at the molecular level and a 
potential biomarker of diseases. Genes Immun. 14, 1–6. 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 
 
37 
Yarden, Y., and Pines, G. (2012). The ERBB network: at last, cancer therapy meets systems 
biology. Nat. Rev. Cancer 12, 553–563. 
York, R.D., Yao, H., Dillon, T., Ellig, C.L., Eckert, S.P., McCleskey, E.W., and Stork, P.J. 
(1998). Rap1 mediates sustained MAP kinase activation induced by nerve growth factor. 
Nature 392, 622–626. 
Yusa, K., Zhou, L., Li, M.A., Bradley, A., and Craig, N.L. (2011). A hyperactive piggyBac 
transposase for mammalian applications. Proc Natl Acad Sci USA 108, 1531–1536. 
.CC-BY-NC-ND 4.0 International licensemade available under a
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is 
The copyright holder for this preprintthis version posted July 27, 2021. ; https://doi.org/10.1101/2021.07.27.453955doi: bioRxiv preprint 